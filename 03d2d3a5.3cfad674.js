(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{104:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=r.a.createContext({}),b=function(e){var t=r.a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=b(e.components);return r.a.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,o=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),p=b(n),u=a,m=p["".concat(o,".").concat(u)]||p[u]||d[u]||c;return n?r.a.createElement(m,s(s({ref:t},i),{},{components:n})):r.a.createElement(m,s({ref:t},i))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,o=new Array(c);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var i=2;i<c;i++)o[i]=n[i];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},63:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(3),r=n(7),c=(n(0),n(104)),o={id:"getstarted",title:"Getting Started"},s={unversionedId:"quickstart/getstarted",id:"quickstart/getstarted",isDocsHomePage:!1,title:"Getting Started",description:"Prerequisites",source:"@site/docs\\quickstart\\getstarted.md",slug:"/quickstart/getstarted",permalink:"/lumos_doc/docs/quickstart/getstarted",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/quickstart/getstarted.md",version:"current",sidebar:"someSidebar",previous:{title:"Overview",permalink:"/lumos_doc/docs/quickstart/intro"},next:{title:"Lumos Indexer",permalink:"/lumos_doc/docs/package/indexer"}},l=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Workflow",id:"workflow",children:[]},{value:"Steps",id:"steps",children:[{value:"Install and Configure Nervos CKB",id:"install-and-configure-nervos-ckb",children:[]},{value:"Create the Node Skeleton",id:"create-the-node-skeleton",children:[]},{value:"Set Up the Config Manager",id:"set-up-the-config-manager",children:[]},{value:"Start the Lumos Indexer",id:"start-the-lumos-indexer",children:[]},{value:"Program Common CKB Tasks",id:"program-common-ckb-tasks",children:[]}]}],i={toc:l};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},i,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(c.b)("p",null,"The following prerequisites apply for using Lumos to develop CKB DApps:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Basic Skills",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"Nervos CKB",". For more details about the basic knowledge of Nervos CKB, see ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.nervos.org/docs/basics/introduction"}),"Nervos CKB Basics"),"."),Object(c.b)("li",{parentName:"ul"},"Knowledge of CKB Data Model. For more details about the CKB data model, see ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.nervos.org/docs/reference/introduction"}),"Nervos CKB Reference")," and ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0019-data-structures/0019-data-structures.md"}),"CKB Data Structure"),"."),Object(c.b)("li",{parentName:"ul"},"Lumos features"))),Object(c.b)("li",{parentName:"ul"},"Development Stacks",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"JavaScript runtime environment: NodeJS version 12+"),Object(c.b)("li",{parentName:"ul"},"Web application framework: Express.js is recommended."),Object(c.b)("li",{parentName:"ul"},"OS:  MacOS, Ubuntu Linux, or Windows 10 + WSL2 (Ubuntu)")))),Object(c.b)("h2",{id:"workflow"},"Workflow"),Object(c.b)("p",null,"The basic steps for developing a CKB DApp are as follows:"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Prepare the prerequisite skills and development stacks listed in ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"../quickstart/getstarted#prerequisites"}),"Prerequisites")),Object(c.b)("li",{parentName:"ol"},"Install and configure Nervos CKB"),Object(c.b)("li",{parentName:"ol"},"Create the node skeleton"),Object(c.b)("li",{parentName:"ol"},"Set up the config manager"),Object(c.b)("li",{parentName:"ol"},"Program common CKB tasks"),Object(c.b)("li",{parentName:"ol"},"Troubleshooting")),Object(c.b)("h2",{id:"steps"},"Steps"),Object(c.b)("h3",{id:"install-and-configure-nervos-ckb"},"Install and Configure Nervos CKB"),Object(c.b)("p",null,"If Nervos CKB is already installed, perform step 6 to start the CKB Node directly."),Object(c.b)("p",null,"To install and configure Nervos CKB:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 1. Download the latest CKB binary file from the CKB releases page on ",Object(c.b)("a",Object(a.a)({parentName:"strong"},{href:"https://github.com/nervosnetwork/ckb/releases"}),"GitHub"),".")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ export TOP=$(pwd)\n# I'm testing this on a Linux machine, if you use other platforms, please adjust\n# this accordingly.\n$ curl -LO https://github.com/nervosnetwork/ckb/releases/download/v0.33.0/ckb_v0.33.0_x86_64-unknown-linux-gnu.tar.gz\n$ tar xzf ckb_v0.33.0_x86_64-unknown-linux-gnu.tar.gz\n$ export PATH=$PATH:$TOP/ckb_v0.33.0_x86_64-unknown-linux-gnu\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 2. Verify the binaries are working and check versions.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ ckb -V\nckb 0.33.0\n$ ckb init -C devnet -c dev\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 3. Modify the chain config to skip difficulty adjustment, and set all epoch to contain 10 blocks.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ ed devnet/specs/dev.toml <<EOF\n91d\n90a\ngenesis_epoch_length = 10\npermanent_difficulty_in_dummy = true\n.\nwq\nEOF\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 4. Modify miner config to generate a new block every second.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ ed devnet/ckb-miner.toml <<EOF\n39s/5000/1000/\nwq\nEOF\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 5. Use a specific private key as the wallet used in miner.")," "),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Note"),": Do not use this private key in other place."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'$ ed devnet/ckb.toml <<EOF\n143a\n[block_assembler]\ncode_hash = "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8"\n# private key: 0x29159d8bb4b27704b168fc7fae70ffebf82164ce432b3f6b4c904a116a969f19\nargs = "0xcbfbb9edb5838e2d61061c3fc69eaaa5fdbd3273"\nhash_type = "type"\nmessage = "0x"\n.\nwq\nEOF\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 6. Start the CKB node with the dev chain.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ ckb run -C devnet\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 7. Start the CKB miner in a different terminal.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ export TOP=$(pwd)\n$ export PATH=$PATH:$TOP/ckb_v0.33.0_x86_64-unknown-linux-gnu\n$ ckb miner -C devnet\n")),Object(c.b)("h3",{id:"create-the-node-skeleton"},"Create the Node Skeleton"),Object(c.b)("p",null,"The node skeleton is used to run the JavaScript code."),Object(c.b)("p",null,"To create the node skeleton:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 1. Create a new directory for the skeleton and navigate into it.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ mkdir mydapp\n$ cd mydapp\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 2. Add Lumos packages as dependencies for the project.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ yarn init\n$ yarn add @ckb-lumos/indexer@0.14.1 @ckb-lumos/common-scripts@0.14.1\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 3. Install all dependencies.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ yarn install\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 4. Enable async/await for the node shell:")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'$ node --experimental-repl-await\nWelcome to Node.js v12.16.2.\nType ".help" for more information.\n>\n')),Object(c.b)("h3",{id:"set-up-the-config-manager"},"Set Up the Config Manager"),Object(c.b)("p",null,"To set up the config manager:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Note"),": The following example shows how to set up the config manager by using pre_defined configurations. The config manager can also be set up by using a local config file. For more information about config manager, see the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"../package/configmanager"}),"Config Manager")," section."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'$ LUMOS_CONFIG_NAME=LINA node --experimental-repl-await\nWelcome to Node.js v12.16.2.\nType ".help" for more information.\n> const { initializeConfig } = require("@ckb-lumos/config-manager");\n> initializeConfig();\n')),Object(c.b)("h3",{id:"start-the-lumos-indexer"},"Start the Lumos Indexer"),Object(c.b)("p",null,"The DApp that is built with Lumos must have an indexer configured and running."),Object(c.b)("p",null,"To start the Lumos indexer:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'> const { Indexer } = require("@ckb-lumos/indexer");\n> const indexer = new Indexer("http://127.0.0.1:8114", "./indexed-data");\n> indexer.startForever();\n')),Object(c.b)("h3",{id:"program-common-ckb-tasks"},"Program Common CKB Tasks"),Object(c.b)("p",null,"The DApps built with Lumos mainly deal with user queries and transaction requests, such as transferring capacity, deposits, withdrawals, and other operations of user assets."),Object(c.b)("h4",{id:"query-flow"},"Query Flow"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"The DApp uses the index database of cells to find all the live cells satisfying the query conditions."),Object(c.b)("li",{parentName:"ol"},"The DApp perform other related operations or calculations and returns the result to the user.")),Object(c.b)("h5",{id:"example-get-the-balance-of-an-account"},"Example: Get the Balance of an Account"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 1. Find all the simple CKB cells for the user.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const script = {\n  code_hash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n  hash_type: "type",\n  args: "0xcbfbb9edb5838e2d61061c3fc69eaaa5fdbd3273"\n};\n\nconst collector = indexer.collector({ lock: script, type: null });\n\nconst cells: Cell[] = [];\nfor await (const cell of collector.collect()) {\n  cells.push(cell);\n}\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 2. Add the capacity of these cells up and return the result as the balance.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"let balance = BigInt(0);\nreturn cells\n  .map((cell) =>\n    BigInt(\n      cell.cell_output.capacity\n    )\n  )\n  .reduce((balance, capacity) => (balance = balance += capacity));\n")),Object(c.b)("h4",{id:"transaction-flow"},"Transaction Flow"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Build a transaction skeleton.")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Add a fee for the transaction. ",Object(c.b)("strong",{parentName:"p"},"Note"),": It is also possible to have someone other than the sender to pay the fee. ")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Prepare the signing entries: The signing entries are the data that the user's wallet needs to sign to provide valid witnesses for the input lock scripts. ")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Send the raw transaction to the client:  From the security perspective of a DApp, Lumos does not support built-in message signing. So the DApp needs to send the raw transaction "," to the user wallet to acquire signatures. The raw transaction contains all the cells and dependencies for the action and the data that needs to be signed. "),Object(c.b)("p",{parentName:"li"},"After the client gets the skeleton, the client forwards the transaction skeleton to the wallet for signing. ")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Seal the transaction: The transaction with signatures is forwarded to the DApp. The DApp seals the transaction by adding the transaction signatures to the transaction structure. ")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Send this finalized transaction to the CKB network: The sealed transaction is then forwarded to the CKB network."),Object(c.b)("p",{parentName:"li"},"Upon successful receipt, the CKB network returns the transaction hash to the DApp. The transaction hash is sent back to the client such that the client can track the transactions.")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"(Optional) Get the Transaction Status: A transaction can be in one of the three statuses: ",Object(c.b)("strong",{parentName:"p"},"pending"),", ",Object(c.b)("strong",{parentName:"p"},"proposed")," and ",Object(c.b)("strong",{parentName:"p"},"committed"),"."),Object(c.b)("p",{parentName:"li"},"A ",Object(c.b)("strong",{parentName:"p"},"pending")," result means the node is aware of the transaction but the transaction is not confirmed yet. "),Object(c.b)("p",{parentName:"li"},"A ",Object(c.b)("strong",{parentName:"p"},"proposed")," result means the node sees a transaction included in a block candidate that is not yet mined. "),Object(c.b)("p",{parentName:"li"},"A ",Object(c.b)("strong",{parentName:"p"},"committed")," result means that the block involving the transaction has been mined and is officially on chain."))),Object(c.b)("h5",{id:"example-transfer-ckb-from-the-current-live-cells"},"Example: Transfer CKB from the Current Live Cells"),Object(c.b)("p",null,"To transfer CKB from the current set of live cells in response to a user request:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 1. Create a transaction skeleton.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"import {sealTransaction, TransactionSkeleton } from \"@ckb-lumos/helpers\";\nimport { common } from \"@ckb-lumos/common-scripts\";\n\nconst tipHeader = {\n  compact_target: '0x20010000',\n  dao: '0x49bfb20771031d556c8480d47f2a290059f0ac7e383b6509006f4a772ed50200',\n  epoch: '0xa0006002b18',\n  hash: '0x432451e23c26f45eaceeedcc261764d6485ea5c9a204ac55ad755bb8dec9a079',\n  nonce: '0x8199548f8a5ac7a0f0caef1620f37b79',\n  number: '0x1aef6',\n  parent_hash: '0x63594a64108f19f6aed53d0dca9ab4075aac4379cb80b2097b0deac8fc16fd3b',\n  proposals_hash: '0x0000000000000000000000000000000000000000000000000000000000000000',\n  timestamp: '0x172f6b9a4cf',\n  transactions_root: '0x282dbadcd49f3e229d997875f37f4e4f19cb4f04fcf762e9639145aaa667b6f8',\n  uncles_hash: '0x0000000000000000000000000000000000000000000000000000000000000000',\n  version: '0x0'\n}\nconst senderaddress = generateAddress(script);\nconst recipient = \"ckt1qyqx57xrsztnq7g5mlw6r998uyc2f5hm3vnsvgsaet\";\nconst amount = 100153459536n;\nconst txFee =  100000000n;\n\nlet txSkeleton = TransactionSkeleton({\n    cellProvider: indexer,\n  });\ntxSkeleton = await common.transfer(\n  txSkeleton,\n  senderaddress,\n  recipient,\n  BigInt(amount),\n  tipHeader\n);\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 2. Add a fee for the transaction.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"  txSkeleton = await common.payFee(\n    txSkeleton,\n    senderaddress,\n    BigInt(txFee),\n    tipHeader\n  );\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 3. Prepare the signing entries.")," "),Object(c.b)("p",null,"To prepare the signing entries:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"})," txSkeleton = common.prepareSigningEntries(txSkeleton);\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 4. Sign the transaction.")),Object(c.b)("p",null,"For demonstration purpose, this example uses a secp256k1 tool to generate a signature based on the private key ",Object(c.b)("inlineCode",{parentName:"p"},"0x29159d8bb4b27704b168fc7fae70ffebf82164ce432b3f6b4c904a116a969f19"),"."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'const signatures = ["0x1cb952fd224d1d14d07af621587e91a65ccb051d55ed1371b3b66d4fe169cf7758173882e4c02587cb54054d2de287cbb1fdc2fc21d848d7b320ee8c5826479901"];\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 5. Seal the transaction with the signatures.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"const tx = sealTransaction(txSkeleton, signatures);\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 6. Send this finalized transaction to the CKB network.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const { RPC } = require("ckb-js-toolkit");\nconst rpc = new RPC("http://127.0.0.1:8114");\nawait rpc.send_transaction(tx);\n\'0x88536e8c25f5f8c89866dec6a5a1a6a72cccbe282963e4a7bfb5542b4c15d376\'\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Step 7. (Optional) Get the Transaction Status.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"const tx = await rpc.get_transaction(txHash);\nreturn tx.tx_status.status;\n")))}b.isMDXComponent=!0}}]);