(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{114:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return u}));var a=t(0),c=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,c=function(e,n){if(null==e)return{};var t,a,c={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(c[t]=e[t]);return c}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var s=c.a.createContext({}),b=function(e){var n=c.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=b(e.components);return c.a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return c.a.createElement(c.a.Fragment,{},n)}},f=c.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),d=b(t),f=a,u=d["".concat(r,".").concat(f)]||d[f]||p[f]||o;return t?c.a.createElement(u,l(l({ref:n},s),{},{components:t})):c.a.createElement(u,l({ref:n},s))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=f;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var s=2;s<o;s++)r[s]=t[s];return c.a.createElement.apply(null,r)}return c.a.createElement.apply(null,t)}f.displayName="MDXCreateElement"},82:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return i})),t.d(n,"default",(function(){return b}));var a=t(3),c=t(7),o=(t(0),t(114)),r={id:"indexer",title:"Indexer"},l={unversionedId:"package/indexer",id:"package/indexer",isDocsHomePage:!1,title:"Indexer",description:"The @ckb-lumos/indexer package implements a CKB cell indexer that fulfills Index-Query-Assemble pattern.",source:"@site/docs\\package\\indexer.md",slug:"/package/indexer",permalink:"/lumos_doc/docs/package/indexer",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/package/indexer.md",version:"current",sidebar:"someSidebar",previous:{title:"Helpers",permalink:"/lumos_doc/docs/package/helpers"},next:{title:"sql-indexer",permalink:"/lumos_doc/docs/package/sqlindexer"}},i=[{value:"Examples",id:"examples",children:[{value:"Start Indexer",id:"start-indexer",children:[]},{value:"Cells Operations",id:"cells-operations",children:[]},{value:"Transactions Operations",id:"transactions-operations",children:[]},{value:"EventEmitter",id:"eventemitter",children:[]}]},{value:"Electron note",id:"electron-note",children:[]}],s={toc:i};function b(e){var n=e.components,t=Object(c.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"@ckb-lumos/indexer")," package implements a CKB cell indexer that fulfills ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.nervos.org/docs/reference/cell#index-query-assemble-pattern"}),Object(o.b)("inlineCode",{parentName:"a"},"Index-Query-Assemble"))," pattern. "),Object(o.b)("p",null,"The Lumos indexer is based on a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/quake/ckb-indexer"}),"Rust based native indexer")," for stability and performance."),Object(o.b)("p",null,"The indexer consumes from the following sources:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Direct access of CKB's data dir via RocksDB's readonly or secondary mode;"),Object(o.b)("li",{parentName:"ul"},"Consistent queries of CKB's RPC.")),Object(o.b)("p",null,"The indexer also supports to store the indexed data in either of the following storage options:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"A local RocksDB directory"),Object(o.b)("li",{parentName:"ul"},"A remote SQL database. The supported databases now include the latest stable versions of PostgreSQL and MySQL. ")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Note"),": This package contains the RocksDB backed indexer. A ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"sqlindexer"}),"separate package")," , the ",Object(o.b)("inlineCode",{parentName:"p"},"@ckb-lumos/sql-indexer")," package contains the SQL backed indexer using the same interface. "),Object(o.b)("p",null,"Lumos is designed based on the Index-Query-Assemble pattern, meaning a dApp shall have an indexer that keeps indexing new blocks in a format that is easier to query. This means any dApp built with Lumos, must also have an indexer configured and running at all time."),Object(o.b)("p",null,"Lumos provides 2 indexer types:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("em",{parentName:"li"},"RocksDB backed indexer")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("em",{parentName:"li"},"SQL backed indexer, supported SQL databases now include MySQL and PostgreSQL"))),Object(o.b)("h2",{id:"examples"},"Examples"),Object(o.b)("h3",{id:"start-indexer"},"Start Indexer"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const { Indexer, CellCollector, TransactionCollector } = require("@ckb-lumos/indexer");\nconst indexer = new Indexer("http://127.0.0.1:8114", "/tmp/indexed-data");\nindexer.startForever();\n')),Object(o.b)("h3",{id:"cells-operations"},"Cells Operations"),Object(o.b)("h4",{id:"query-cells"},"Query Cells"),Object(o.b)("p",null,"To query existing cells, create a CellCollector:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash:\n      "0x0000000000000000000000000000000000000000000000000000000000000000",\n    hash_type: "data",\n    args: "0x62e907b15cbf27d5425399ebf6f0fb50ebb88f18",\n  },\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("h4",{id:"specify-lock-and-type-script"},"Specify ",Object(o.b)("inlineCode",{parentName:"h4"},"lock")," and ",Object(o.b)("inlineCode",{parentName:"h4"},"type")," Script"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n    lock: {\n        args: "0x92aad3bbab20f225cff28ec1d856c6ab63284c7a",\n        code_hash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        hash_type: "type"\n    },\n    type: {\n        args: "0x",\n        code_hash: "0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e",\n        hash_type: "type"\n    }\n})\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("h4",{id:"query-cells-between-given-block_numbers"},"Query Cells between Given block_numbers"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x225510", // "0x" + 2250000n.toString(16)\n  toBlock: "0x225ce0", // "0x" + 2252000n.toString(16)\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("p",null,"It will fetch cells between ",Object(o.b)("inlineCode",{parentName:"p"},"[fromBlock, toBlock]"),", which means both ",Object(o.b)("inlineCode",{parentName:"p"},"fromBlock")," and ",Object(o.b)("inlineCode",{parentName:"p"},"toBlock")," are included in query range."),Object(o.b)("h4",{id:"skip-cells"},"Skip Cells"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  skip: 100,\n});\n\nfor await (const tx of cellCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"skip")," field represents the number of cells being skipped, which in the above code snippet means it would skip the first 100 cells and return from the 101st. cell."),Object(o.b)("h4",{id:"order-cells-by-block-number-by-setting-the-order-field"},"Order Cells by Block Number by Setting the ",Object(o.b)("inlineCode",{parentName:"h4"},"order")," Field"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("h4",{id:"prefix-search-on-args"},"Prefix Search on ",Object(o.b)("inlineCode",{parentName:"h4"},"args")),Object(o.b)("p",null,"The default ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," is -1, which means you pass the full slice of original args, and you can specify it when the ",Object(o.b)("inlineCode",{parentName:"p"},"args")," field is the prefix of original args."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df3", // truncate the last byte of orignal args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: 20, // default option is -1\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("p",null,"We recommend to specify explicit length for the ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," field. For example, the length is 20 in normal scenario and 28 in multisig scenario for lock script.  When the length is not certain, the ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," field can be set as ",Object(o.b)("inlineCode",{parentName:"p"},"any"),". But there is performance lost when use ",Object(o.b)("inlineCode",{parentName:"p"},"any")," rather than explicitly specified length."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7d", // truncate the last two bytes of original args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: "any",\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("h4",{id:"fine-grained-query-for-cells"},"Fine Grained Query for Cells"),Object(o.b)("p",null,"Fine grained query for cells can be achieved by using ",Object(o.b)("inlineCode",{parentName:"p"},"ScriptWrapper")," with customized options like ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'cellCollector = new CellCollector(indexer, {\n  lock: {\n    script: {\n      code_hash: \n        "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n      hash_type: "type",\n      args: "0xe60f7f88c94ef365d540afc1574c46bb017765", // trucate the last byte of original args: 0xe60f7f88c94ef365d540afc1574c46bb017765a2\n    },\n    argsLen: 20, \n  },\n  type: {\n    script: {\n      code_hash: "0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e",\n      hash_type: "type",\n      args: "0x",\n    },\n    // when the `argsLen` is not setted here, it will use the outside `argsLen` config, which in this case is -1 by default\n  }\n});\n\nfor await (const cell of cellCollector.collect()) {\n  console.log(cell);\n}\n')),Object(o.b)("h3",{id:"transactions-operations"},"Transactions Operations"),Object(o.b)("h4",{id:"query-transactions"},"Query Transactions"),Object(o.b)("p",null,"To query transactions related to a lock script:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash:\n      "0x0000000000000000000000000000000000000000000000000000000000000000",\n    hash_type: "data",\n    args: "0x62e907b15cbf27d5425399ebf6f0fb50ebb88f18",\n  },\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("h4",{id:"query-transactions-between-given-block-numbers"},"Query Transactions between Given Block Numbers"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x0", // "0x" + 0n.toString(16) \n  toBlock: "0x7d0" , // "0x" + 2000n.toString(16)\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("p",null,"It will fetch transactions between ",Object(o.b)("inlineCode",{parentName:"p"},"[fromBlock, toBlock]"),", which means both ",Object(o.b)("inlineCode",{parentName:"p"},"fromBlock")," and ",Object(o.b)("inlineCode",{parentName:"p"},"toBlock")," are included in query range."),Object(o.b)("h4",{id:"skip-transactions"},"Skip Transactions"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  skip: 100,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"skip")," field represents the number of transactions being skipped, which in the above code snippet means it would skip the first 100 transactions and return from the 101st one."),Object(o.b)("h4",{id:"order-transactions-by-block-number"},"Order Transactions by Block Number"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x4e20", // "0x" + 20000n.toString(16)\n  toBlock: "0x5208", // "0x" + 21000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 10,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("h4",{id:"prefix-search-on-args-1"},"Prefix Search on ",Object(o.b)("inlineCode",{parentName:"h4"},"args")),Object(o.b)("p",null,"The default ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," is -1, which means you pass the full slice of original args, and you can specify it when the ",Object(o.b)("inlineCode",{parentName:"p"},"args")," field is the prefix of original args."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df3", // truncate the last byte of orignal args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: 20, // default option is -1\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("p",null,"We recommend to specify explicit length for the ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," field. For example, the length is 20 in normal scenario and 28 in multisig scenario for lock script.  When the length is not certain, the ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen")," field can be set as ",Object(o.b)("inlineCode",{parentName:"p"},"any"),". But there is performance lost when use ",Object(o.b)("inlineCode",{parentName:"p"},"any")," rather than explicitly specified length."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7d", // truncate the last two bytes of original args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: "any",\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("h4",{id:"fine-grained-query-for-transactions"},"Fine Grained Query for Transactions"),Object(o.b)("p",null,"Fine Grained Query for Transactions can be achieved by using ",Object(o.b)("inlineCode",{parentName:"p"},"ScriptWrapper")," with customized options like ",Object(o.b)("inlineCode",{parentName:"p"},"ioType"),", ",Object(o.b)("inlineCode",{parentName:"p"},"argsLen"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    script: {\n      code_hash: \n        "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n      hash_type: "type",\n      args: "0xe60f7f88c94ef365d540afc1574c46bb017765", // trucate the last byte of original args: 0xe60f7f88c94ef365d540afc1574c46bb017765a2\n    },\n    ioType: "both",\n    argsLen: 20, // when the `argsLen` is not setted here, it will use the outside `argsLen` config\n  },\n  type: {\n    script: {\n      code_hash: "0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e",\n      hash_type: "type",\n      args: "0x",\n    },\n    ioType: "input",\n  }\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"ioType")," field is among ",Object(o.b)("inlineCode",{parentName:"p"},"input | output | both"),"."),Object(o.b)("h3",{id:"eventemitter"},"EventEmitter"),Object(o.b)("p",null,"Event-driven pattern is also supported besides the above polling pattern. After subscribing for certain ",Object(o.b)("inlineCode",{parentName:"p"},"lock|type")," script, it will emit a ",Object(o.b)("inlineCode",{parentName:"p"},"changed")," event when a block containing the subscribed script is indexed or rollbacked. "),Object(o.b)("p",null,"The principle of the design is unreliable notification queue, so developers are supposed to pull from the data sources via ",Object(o.b)("inlineCode",{parentName:"p"},"CellCollector|TransactionCollector"),", to find out what might happened: cell consumed, new cell generated, new transaction generated, or a chain fork happened, etc; and take the next step accordingly."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'eventEmitter = indexer.subscribe({\n  lock: {\n    code_hash:\n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n});\n\neventEmitter.on("changed",  () => {\n  console.log("States changed with the script, please pull the data sources from the indexer to find out what happend");\n})\n\n')),Object(o.b)("p",null,"Other query options like ",Object(o.b)("inlineCode",{parentName:"p"},"fromBlock|argsLen|data")," are also supported."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'eventEmitter = indexer.subscribe({\n  lock: {\n    code_hash:\n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    // the args bytes length is 18, truncate the last 2 bytes.\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7d",\n  },\n  // default value is -1\n  argsLen: 20,\n  // default value is "any"\n  data: "0x",\n  // default value is 0\n  fromBlock: 0x3e8, // "0x" + 1000n.toString(16)\n});\n')),Object(o.b)("p",null,"Listen to median time change when blocks changed."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const medianTimeEmitter = indexer.subscribeMedianTime();\nmedianTimeEmitter.on("changed", (medianTime) => {\n  console.log(medianTime);\n});\n')),Object(o.b)("h2",{id:"electron-note"},"Electron note"),Object(o.b)("p",null,"One design goal of Lumos, is that even though we might leverage native Rust code to speed things up, you don't need to have Rust installed in your machine to use the framework. However, this goal hits a slight roadblock since electron have its own module versions."),Object(o.b)("p",null,"There are 2 paths to work around this issue:"),Object(o.b)("p",null,"First, we do provide pre-built binaries linked with electron's node version. Use the following command to install npm dependencies in your Electron app:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ LUMOS_NODE_RUNTIME=electron npm i\n")),Object(o.b)("p",null,"This will make sure that pre-built binaries compiled for Electron will be downloaded."),Object(o.b)("p",null,"Second, you can also follow the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://neon-bindings.com/docs/electron-apps"}),"steps")," in Neon's documentation to rebuild the binaries. Note this path would require Rust being installed on your system for now."),Object(o.b)("p",null,"Note this issue is actually caused since we are still leveraging the old native node module solution. We are also evaluating other solutions, such as ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://medium.com/@atulanand94/beginners-guide-to-writing-nodejs-addons-using-c-and-n-api-node-addon-api-9b3b718a9a7f"}),"N-API"),", which is based on a stable API, so there is no need to recompile everything for a different Node.js version. We do hope that in later versions, we can convert to N-API so there is not need to deal with inconsistent module versions."))}b.isMDXComponent=!0}}]);