(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{126:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return f}));var l=t(0),c=t.n(l);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,l,c=function(e,n){if(null==e)return{};var t,l,c={},a=Object.keys(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||(c[t]=e[t]);return c}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var i=c.a.createContext({}),b=function(e){var n=c.a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=b(e.components);return c.a.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return c.a.createElement(c.a.Fragment,{},n)}},u=c.a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,r=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),p=b(t),u=l,f=p["".concat(r,".").concat(u)]||p[u]||d[u]||a;return t?c.a.createElement(f,o(o({ref:n},i),{},{components:t})):c.a.createElement(f,o({ref:n},i))}));function f(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,r=new Array(a);r[0]=u;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var i=2;i<a;i++)r[i]=t[i];return c.a.createElement.apply(null,r)}return c.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},88:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return b}));var l=t(3),c=t(7),a=(t(0),t(126)),r={id:"querycells",title:"Query on Cells"},o={unversionedId:"tutorials/querycells",id:"tutorials/querycells",isDocsHomePage:!1,title:"Query on Cells",description:"Cells are the primary state units in CKB and assets owned by users. A cell is the most basic structure that represents a single piece of data in Nervos. The data contained in a cell can take many forms, including CKBytes, tokens, code like JavaScript code, or even serialized data like JSON strings. For more information about the cell model, see Nervos Docs CKB Cell.",source:"@site/docs\\tutorials\\queryCells.md",slug:"/tutorials/querycells",permalink:"/lumos_doc/docs/tutorials/querycells",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/tutorials/queryCells.md",version:"current",sidebar:"sidebar2",previous:{title:"Set Up the Lumos Indexer",permalink:"/lumos_doc/docs/tutorials/indexer"},next:{title:"Operate on Cells",permalink:"/lumos_doc/docs/tutorials/operateoncells"}},s=[{value:"Query Options",id:"query-options",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Environment",id:"environment",children:[]},{value:"Examples",id:"examples",children:[{value:"Query Cells by a Lock Script",id:"query-cells-by-a-lock-script",children:[]},{value:"Query Cells by Specific Lock and Type Script",id:"query-cells-by-specific-lock-and-type-script",children:[]},{value:"Query Cells between Given Block Numbers",id:"query-cells-between-given-block-numbers",children:[]},{value:"Skip Cells",id:"skip-cells",children:[]},{value:"Prefix Search on <var>args</var>",id:"prefix-search-on-args",children:[]},{value:"Fine-grained Query for Cells",id:"fine-grained-query-for-cells",children:[]},{value:"Order Cells by Block Number",id:"order-cells-by-block-number",children:[]},{value:"Fetch Cells in Locktime Pool",id:"fetch-cells-in-locktime-pool",children:[]}]}],i={toc:s};function b(e){var n=e.components,t=Object(c.a)(e,["components"]);return Object(a.b)("wrapper",Object(l.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Cells are the primary state units in CKB and assets owned by users. A cell is the most basic structure that represents a single piece of data in Nervos. The data contained in a cell can take many forms, including CKBytes, tokens, code like JavaScript code, or even serialized data like JSON strings. For more information about the cell model, see ",Object(a.b)("a",{parentName:"p",href:"https://docs.nervos.org/docs/reference/cell"},"Nervos Docs: Cell")," and ",Object(a.b)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md#42-cell"},"CKB RFC: CKB Cell"),".")),Object(a.b)("p",null,"Querying on cells are the fundamental functions for a DApp to respond to user queries and transaction requests. Lumos provides functions for the queries on cells with specific query options."),Object(a.b)("p",null,"The following example is a cell retrieved by Lumos query functions:"),Object(a.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(a.b)("div",{parentName:"div",className:"admonition-heading"},Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",{parentName:"h5",className:"admonition-icon"},Object(a.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(a.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(a.b)("div",{parentName:"div",className:"admonition-content"},Object(a.b)("p",{parentName:"div"},"Lumos enriches the cell structure defined in ",Object(a.b)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md#42-cell"},"CKB RFC: Cell")," with some customized fields (",Object(a.b)("inlineCode",{parentName:"p"},"out_point"),", ",Object(a.b)("inlineCode",{parentName:"p"},"block_hash")," and ",Object(a.b)("inlineCode",{parentName:"p"},"block_number"),"). "))),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"{\n  cell_output: {\n    capacity: '0x124788a824a4',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: undefined\n  },\n  out_point: {\n    tx_hash: '0x86a613998a501777f2c3d808f235a8767d28d56868678dd17b53797f280b8b61',\n    index: '0x0'\n  },\n  block_hash: '0xd75069d050a530f8e670235bbcf6054e14326f81b37e5220bb3fc3513ef7e97c',\n  block_number: '0x45',\n  data: '0x'\n}\n")),Object(a.b)("h2",{id:"query-options"},"Query Options"),Object(a.b)("p",null,"Lumos supports to query on cells for the options including ",Object(a.b)("var",null,"lock"),", ",Object(a.b)("var",null,"type"),", ",Object(a.b)("var",null,"argsLen"),", ",Object(a.b)("var",null,"data"),", ",Object(a.b)("var",null,"fromBlock"),", ",Object(a.b)("var",null,"toBlock"),", ",Object(a.b)("var",null,"skip")," and ",Object(a.b)("var",null,"order"),"."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"lock"),": A lock script or a ScriptWrapper of a lock script."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"type"),": A type script or a ScriptWrapper of a type script.",Object(a.b)("p",{parentName:"li"},"The ",Object(a.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/base.scriptwrapper.html"},"ScriptWrapper")," interface combines ",Object(a.b)("var",null,"argsLen")," and ",Object(a.b)("var",null,"ioType")," with a lock or type script to enable fine-grained queries. For more information, see ",Object(a.b)("a",{parentName:"p",href:"../tutorials/querycells#fine-grained-query-for-cells"},"Fine-grained Query for Cells"),".")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"argsLen"),": The lock or type args length. The default value of ",Object(a.b)("var",null,"argsLen")," is -1 for the query on a full slice of the args."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"data"),": The cell data field."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"fromBlock"),": The starting block number that the query returns."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"toBlock"),": The ending block number that the query returns."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"skip"),": The number of cells being skipped for the Lumos indexer."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("var",null,"order"),": The query result can be returned in order of block numbers. The default value is ",Object(a.b)("var",null,"asc")," (ascending) for the returned result.")),Object(a.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(a.b)("p",null,"The following prerequisites apply for the examples of this guide:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"The development environment is set up. For more information, see ",Object(a.b)("a",{parentName:"li",href:"http://localhost:3000/lumos_doc/docs/preparation/setupsystem"},"Set Up the Development Environment"),"."),Object(a.b)("li",{parentName:"ul"},"The CKB node is installed and started. For more information, see ",Object(a.b)("a",{parentName:"li",href:"http://localhost:3000/lumos_doc/docs/preparation/installckb"},"Install a CKB Node"),"."),Object(a.b)("li",{parentName:"ul"},"The Lumos packages (",Object(a.b)("inlineCode",{parentName:"li"},"@ckb-lumos/base"),", ",Object(a.b)("inlineCode",{parentName:"li"},"@ckb-lumos/indexer"),", ",Object(a.b)("inlineCode",{parentName:"li"},"@ckb-lumos/helpers"),", ",Object(a.b)("inlineCode",{parentName:"li"},"@ckb-lumos/common-scripts"),") are installed.")),Object(a.b)("h2",{id:"environment"},"Environment"),Object(a.b)("p",null,"The following examples are verified on Ubuntu 20.04.2. Steps on the other platforms can be adjusted accordingly."),Object(a.b)("h2",{id:"examples"},"Examples"),Object(a.b)("h3",{id:"query-cells-by-a-lock-script"},"Query Cells by a Lock Script"),Object(a.b)("p",null,"The following example collects the cells for a specific lock script."),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsbyLock" {5}',title:'"hellolumos/src/querycells.ts/findCellsbyLock"',"{5}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\n\nexport const findCellsbyLock = async (lockScript: Script): Promise<Cell[]> => {\n  const collector = INDEXER.collector({ lock: lockScript });\n  const cells: Cell[] = [];\n  console.log("Find the cells by lock script:");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n  }\n  return cells;\n};\n')),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"INDEXER")," of the example is a RockDB backed indexer that is initialized and started in the hellolumos/src/index.ts file. For more information about setting up the Lumos indexer, see ",Object(a.b)("a",{parentName:"p",href:"../tutorials/indexer#set-up-the-rocksdb-backed-indexer"},"Set Up the RocksDB Backed Indexer"),"."),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsbyLock")," function in the Node.js REPL mode:"),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-13}","{1,2,5,7-13}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> const script = {\n code_hash: \"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8\",\n hash_type: \"type\",\n args: alice.ARGS,\n };\n> await querycells.findCellsbyLock(script);\nFind the cells by lock script:\n[\n  {\n    cell_output: { capacity: '0x1247953509b2', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xe8655b071e3eeb94d73c2307295bbe88431e74d9091bd8ec081404a9ac485251',\n      index: '0x0'\n    },\n    block_hash: '0x4feda2b0950c3137d4a2128cbe7b25f9dd255c3468007a6b10118f2fccd855bb',\n    block_number: '0x26',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x124794cb65db', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xd99327f73c6278589d59cde617982a08e3fabadefa18bbae14eab30fa89b9fb1',\n      index: '0x0'\n    },\n    block_hash: '0xe8016c14a198a2b9f7acd4964ec876527ff55082d6e3a210e7b73c6316f86690',\n    block_number: '0x27',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x12479461c26d', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0x0b2ac03c909402057eabf4202ae3ee8fc65f9f6182837db2599c53d2cc8051ba',\n      index: '0x0'\n    },\n    block_hash: '0x19bb281bc4e53a76cce55a10b99abf82bc528b6eb37e72c9bd62cd520109a1a8',\n    block_number: '0x28',\n    data: '0x'\n  },\n...\n]\n")))),Object(a.b)("h3",{id:"query-cells-by-specific-lock-and-type-script"},"Query Cells by Specific Lock and Type Script"),Object(a.b)("p",null,"The following example collects the cells for a specific lock script and a type script, and returns the cells as the result."),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsbyLockandType" {8}',title:'"hellolumos/src/querycells.ts/findCellsbyLockandType"',"{8}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\n\nexport async function findCellsbyLockandType(\n  lockScript: Script,\n  typeScript: Script\n): Promise<Cell[]> {\n  const collector = INDEXER.collector({ lock: lockScript, type: typeScript });\n  const cells: Cell[] = [];\n  console.log("Find the cells by Lock and Type script");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsbyLockandType")," function in the Node.js REPL mode:"),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1-2,5,7-19}","{1-2,5,7-19}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells, CONFIG } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> const script = {\n code_hash: \"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8\",\n hash_type: \"type\",\n args: alice.ARGS,\n };\n> const template = CONFIG.SCRIPTS[\"DAO\"];\n> const typescript = {\n code_hash: template.CODE_HASH,\n hash_type: template.HASH_TYPE,\n args: \"0x\",\n };\n> await querycells.findCellsbyLockandType(script,typescript);\nFind the cells by Lock and Type script\n[\n  {\n    cell_output: { capacity: '0x4a817c800', lock: [Object], type: [Object] },\n    out_point: {\n      tx_hash: '0x313378dc3ce2d5c3f3efd546bc9595b54907844c20a72adae15cb9e970ce90df',\n      index: '0x0'\n    },\n    block_hash: '0x657bef9f9d300bfd884065992f243770b9fa7dc8aafa304c98e210d2e02d1248',\n    block_number: '0x12c',\n    data: '0x6a00000000000000'\n  },\n  {\n    cell_output: { capacity: '0x4a817c800', lock: [Object], type: [Object] },\n    out_point: {\n      tx_hash: '0xbc708146e8fea53a4629d37fbd345f7e9dca79225d90bb1f73e7077ade93da19',\n      index: '0x0'\n    },\n    block_hash: '0xfc4a10116dbfb591796dcbf19e95c26ac647e7c2e41fc1b327a19c7ddd1eb938',\n    block_number: '0x135',\n    data: '0x1a01000000000000'\n  }\n]\n")))),Object(a.b)("h3",{id:"query-cells-between-given-block-numbers"},"Query Cells between Given Block Numbers"),Object(a.b)("p",null,"The following example fetches the cells between ","[",Object(a.b)("var",null,"fromblock"),", ",Object(a.b)("var",null,"toblock"),"]",". "),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsBetweenBlocks" {9}',title:'"hellolumos/src/querycells.ts/findCellsBetweenBlocks"',"{9}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\n\nexport async function findCellsBetweenBlocks(\n  lockScript: Script,\n  fromBlock: string,\n  toBlock: string\n): Promise<Cell[]> {\n  const collector = INDEXER.collector({ lock: lockScript, fromBlock, toBlock });\n  const cells: Cell[] = [];\n  console.log("Find cells from block", fromBlock, "to block", toBlock);\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n    // console.log(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsBetweenBlocks")," function in the Node.js REPL mode:"),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-15}","{1,2,5,7-15}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> const script = {\n code_hash: \"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8\",\n hash_type: \"type\",\n args: alice.ARGS,\n };\n> const from = \"0x81\";\n> const to = \"0x83\";\n> await querycells.findCellsBetweenBlocks(script, from, to);\nFind cells from block 0x81 to block 0x84\n[\n  {\n    cell_output: { capacity: '0x12476faec3ef', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0x4f6efa5ee4a116940d2dfe549c1e2ddac9ae02268d68d5e300fade7e8466072d',\n      index: '0x0'\n    },\n    block_hash: '0x6a8d2e35b024128c06cbf5ba551b6c7de576566fce12e61c646052e622f701d7',\n    block_number: '0x81',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x12476fa0d2a2', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xede91f58056a467cf5114a258ebc7a96a581e8e0a23fde083f84f833a6f0503c',\n      index: '0x0'\n    },\n    block_hash: '0xaefdfe2473ce86d137cbb9d2e7cf4f1f3600663bb18aa6e4d30518c6b3870be5',\n    block_number: '0x82',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x12476edbf23a', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0x73c528726d7ca1cad5af6d7debdf962814f49994ef8ad686d071d8aac96e394c',\n      index: '0x0'\n    },\n    block_hash: '0x721d22c925d98b0260d9b6a647fdb6e93010f816f1158c14971a73c0cb073b60',\n    block_number: '0x83',\n    data: '0x'\n  },\n]\n")))),Object(a.b)("h3",{id:"skip-cells"},"Skip Cells"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"skip")," parameter represents the number of cells being skipped for the Lumos indexer. "),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsandSkip" {8}',title:'"hellolumos/src/querycells.ts/findCellsandSkip"',"{8}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\n\nexport async function findCellsandSkip(\n  lockScript: Script,\n  skip: number\n): Promise<Cell[]> {\n  const collector = INDEXER.collector({ lock: lockScript, skip: skip });\n  const cells: Cell[] = [];\n  console.log("Find Cells and Skip the first", skip, "cells:");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n    console.log(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsandSkip")," function in the Node.js REPL mode: "),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,Object(a.b)("p",null,"The example skips the first 20 cells and get the result from the 21st. cell by using the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsandSkip")," function."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-13}","{1,2,5,7-13}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> const script = {\n code_hash: \"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8\",\n hash_type: \"type\",\n args: alice.ARGS,\n };\n> await querycells.findCellsandSkip(script, 20);\n{\n  cell_output: {\n    capacity: '0x1247656167b4',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: undefined\n  },\n  out_point: {\n    tx_hash: '0xdcd898c29a2d9dcbaca6c5112bb681d55acb5a557aaf2cbaa1ea2fe561ba3b36',\n    index: '0x0'\n  },\n  block_hash: '0x8030e31e760905f4e2c220f45b653ed73d0bdea5962bd34ca96bc3ea50cbc725',\n  block_number: '0x9a',\n  data: '0x'\n}\n{\n  cell_output: {\n    capacity: '0x124764f7f310',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: undefined\n  },\n  out_point: {\n    tx_hash: '0x0913fd98eb1a56c9b7a460cf46f6c447d0a5048c5f2ad955c3ae7c74d3d55bbf',\n    index: '0x0'\n  },\n  block_hash: '0x19b16cd024c8d3ae06a5cd20db7f86a04b0b3160d499145d8fdee659c959f70d',\n  block_number: '0x9b',\n  data: '0x'\n}\n...\n")))),Object(a.b)("h3",{id:"prefix-search-on-args"},"Prefix Search on ",Object(a.b)("var",null,"args")),Object(a.b)("p",null,"To enable the prefix search on the args of a lock script or a type script, ",Object(a.b)("var",null,"argsLen")," can be assigned with a value other than the default value -1."),Object(a.b)("p",null,"The lock script args length is ",Object(a.b)("strong",{parentName:"p"},"20")," in normal scenarios and ",Object(a.b)("strong",{parentName:"p"},"28")," in the multisig scenario. When the length is not certain, the ",Object(a.b)("var",null,"argsLen")," parameter can be set as ",Object(a.b)("inlineCode",{parentName:"p"},"any"),". "),Object(a.b)("div",{className:"admonition admonition-info alert alert--info"},Object(a.b)("div",{parentName:"div",className:"admonition-heading"},Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",{parentName:"h5",className:"admonition-icon"},Object(a.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(a.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(a.b)("div",{parentName:"div",className:"admonition-content"},Object(a.b)("p",{parentName:"div"},"It is recommended to specify an explicit length for the ",Object(a.b)("var",null,"argsLen")," parameter in a prefix search, that has better performance than using ",Object(a.b)("inlineCode",{parentName:"p"},"any")," for ",Object(a.b)("var",null,"argsLen"),"."))),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsbyPrefix" {8}',title:'"hellolumos/src/querycells.ts/findCellsbyPrefix"',"{8}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\n\nexport async function findCellsbyPrefix(\n  lockScript: Script,\n  argslen: number\n): Promise<Cell[]> {\n  const collector = INDEXER.collector({ lock: lockScript, argsLen: argslen });\n  const cells: Cell[] = [];\n  console.log("Find Cells by prefix of args");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("h3",{id:"fine-grained-query-for-cells"},"Fine-grained Query for Cells"),Object(a.b)("p",null,"Fine-grained query can query on cells at the granularity of a lock or type script, and the args length of the lock or type script by using ",Object(a.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/base.scriptwrapper.html"},"ScriptWrapper"),". "),Object(a.b)("p",null,"The query gets the cells with a specific lock or type script, and the args length of the script is ",Object(a.b)("var",null,"argsLen"),". If ",Object(a.b)("var",null,"argsLen")," is not specified, the ",Object(a.b)("var",null,"argsLen")," config outside of the ScriptWrapper or the default value -1 will be used."),Object(a.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(a.b)("div",{parentName:"div",className:"admonition-heading"},Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",{parentName:"h5",className:"admonition-icon"},Object(a.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(a.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(a.b)("div",{parentName:"div",className:"admonition-content"},Object(a.b)("var",null,"ioType")," is inapplicable in the fine-grained query for cells.")),Object(a.b)("p",null,"The following example is the fine-grained query for cells on a lock script and a lock args length. "),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/finegrainedSearch()" {9-13}',title:'"hellolumos/src/querycells.ts/finegrainedSearch()"',"{9-13}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script, ScriptWrapper } from "@ckb-lumos/base";\n\nexport async function finegrainedSearch(\n  lockScript: Script,\n  argslen: number,\n  iotype: "output" | "input" | "both"\n): Promise<Cell[]> {\n  const lock: ScriptWrapper = {\n    script: lockScript,\n    ioType: iotype,\n    argsLen: argslen,\n  };\n  const collector = INDEXER.collector({ lock: lock });\n  const cells: Cell[] = [];\n  console.log("Fine-Grained Query:");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"finegrainedSearch")," function in Node.js REPL mode:"),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-14}","{1,2,5,7-14}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells } = require(\".\");\nThe server is started.\n> const bob = accounts.BOB;\n> const script = {\n code_hash: \"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8\",\n hash_type: \"type\",\n args: bob.ARGS,\n };\n> const argslen = 20;\n> await querycells.finegrainedSearch(script, argslen);\n//The result shows the three cells with Bob's lock script and the lock args length is 20 bytes.\nFine-Grained Query:\n[\n  {\n    cell_output: { capacity: '0x1247953509b2', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xe8655b071e3eeb94d73c2307295bbe88431e74d9091bd8ec081404a9ac485251',\n      index: '0x0'\n    },\n    block_hash: '0x4feda2b0950c3137d4a2128cbe7b25f9dd255c3468007a6b10118f2fccd855bb',\n    block_number: '0x26',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x124794cb65db', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xd99327f73c6278589d59cde617982a08e3fabadefa18bbae14eab30fa89b9fb1',\n      index: '0x0'\n    },\n    block_hash: '0xe8016c14a198a2b9f7acd4964ec876527ff55082d6e3a210e7b73c6316f86690',\n    block_number: '0x27',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x12479461c26d', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0x0b2ac03c909402057eabf4202ae3ee8fc65f9f6182837db2599c53d2cc8051ba',\n      index: '0x0'\n    },\n    block_hash: '0x19bb281bc4e53a76cce55a10b99abf82bc528b6eb37e72c9bd62cd520109a1a8',\n    block_number: '0x28',\n    data: '0x'\n  },\n...\n]\n")))),Object(a.b)("h3",{id:"order-cells-by-block-number"},"Order Cells by Block Number"),Object(a.b)("p",null,"The following example creates a new ",Object(a.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/classes/indexer.cellcollector.html"},"CellCollector")," and uses the CellCollector to collect cells in order of block numbers for a specific lock script."),Object(a.b)("p",null,"Example:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/findCellsandOrder" {11}',title:'"hellolumos/src/querycells.ts/findCellsandOrder"',"{11}":!0},'import { INDEXER } from "./index";\nimport { Cell, Script } from "@ckb-lumos/base";\nimport { CellCollector } from "@ckb-lumos/indexer";\n\nexport async function findCellsandOrder(\n  lockScript: Script,\n  order: "asc" | "desc"\n): Promise<Cell[]> {\n  const collector = new CellCollector(INDEXER, {\n    lock: lockScript,\n    order: order,\n  });\n  const cells: Cell[] = [];\n  console.log("Find Cells in", order, "order of block numbers:");\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"Try the ",Object(a.b)("inlineCode",{parentName:"p"},"findCellsandOrder")," function in Node.js REPL mode: "),Object(a.b)("details",null,Object(a.b)("summary",null,"CLICK ME"),Object(a.b)("p",null,"The following example gets the live cells for Alice and returns the result in descending order of block numbers.",Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-13}","{1,2,5,7-13}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> const { parseAddress } = require(\"@ckb-lumos/helpers\");\n> const script = parseAddress(alice.ADDRESS);\n> await querycells.findCellsandOrder(script,\"desc\");\nFind Cells in desc order of block numbers:\n[\n  {\n    cell_output: { capacity: '0x124462255f12', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0x53d845d810109d6ee4e94df96565100a4126c6fa671db1d237f60eca4a8d2105',\n      index: '0x0'\n    },\n    block_hash: '0x0301f7aa0c2902383e15662008f9886aa4cd628c4948ba737d13894e7334ea54',\n    block_number: '0x805',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x1244628be0aa', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xea8f658e6ea08c38f58f6a0af3530396aba0e51e1064db8626ecd38976625c34',\n      index: '0x0'\n    },\n    block_hash: '0xbae60c9c4f54d6f6a970fb76c2fdd226a83dd8724cff082157da559ce6cf507f',\n    block_number: '0x804',\n    data: '0x'\n  },\n  {\n    cell_output: { capacity: '0x1242ecee4f71', lock: [Object], type: undefined },\n    out_point: {\n      tx_hash: '0xe332fb6efba38e16b8fd20a4f47d5fffcf8fcac0c863b0eb30ef75067847936d',\n      index: '0x1'\n    },\n    block_hash: '0xd0c09a6615b30f685dd0b0e627021f89e0f35e9b59c575001d8a11f63436b76c',\n    block_number: '0x803',\n    data: '0x'\n  },\n...\n")))),Object(a.b)("h3",{id:"fetch-cells-in-locktime-pool"},"Fetch Cells in Locktime Pool"),Object(a.b)("p",null,"Lumos provides the ",Object(a.b)("inlineCode",{parentName:"p"},"locktimepool")," module for the cells with a lock period. Now the ",Object(a.b)("inlineCode",{parentName:"p"},"locktimepool")," module supports DAO withdrawn cells and Multisig cells. "),Object(a.b)("p",null,"The following example collects all the ",Object(a.b)("strong",{parentName:"p"},"withdrawn")," cells and ",Object(a.b)("strong",{parentName:"p"},"Multisig")," cells that with a lock period of an account and returns the collected cells as the result. "),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/querycells.ts/locktimePoolCells"',title:'"hellolumos/src/querycells.ts/locktimePoolCells"'},'import { locktimePool } from "@ckb-lumos/common-scripts";\n\nexport async function locktimePoolCells(frominfo: string): Promise<Cell[]> {\n  const collector = new locktimePool.CellCollector(frominfo, INDEXER);\n  const cells: Cell[] = [];\n  for await (const cell of collector.collect()) {\n    cells.push(cell);\n    console.log(cell);\n  }\n  return cells;\n}\n')),Object(a.b)("p",null,"For more information, see the ",Object(a.b)("a",{parentName:"p",href:"../tutorials/buildtransactions#transfer-ckb-with-locktime-pool"},"Transfer CKB with Locktime Pool")," example."))}b.isMDXComponent=!0}}]);