(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{119:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),l=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=l.a.createContext({}),b=function(e){var t=l.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=b(e.components);return l.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return l.a.createElement(l.a.Fragment,{},t)}},d=l.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),u=b(n),d=a,m=u["".concat(r,".").concat(d)]||u[d]||p[d]||o;return n?l.a.createElement(m,c(c({ref:t},s),{},{components:n})):l.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var s=2;s<o;s++)r[s]=n[s];return l.a.createElement.apply(null,r)}return l.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},87:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return b}));var a=n(3),l=n(7),o=(n(0),n(119)),r={id:"hellolumos",title:"Hello Lumos"},c={unversionedId:"preparation/hellolumos",id:"preparation/hellolumos",isDocsHomePage:!1,title:"Hello Lumos",description:"The Hello Lumos example is designed to serve as the starting point for learning Lumos.",source:"@site/docs\\preparation\\hellolumos.md",slug:"/preparation/hellolumos",permalink:"/lumos_doc/docs/preparation/hellolumos",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/preparation/hellolumos.md",version:"current",sidebar:"someSidebar",previous:{title:"Create Accounts",permalink:"/lumos_doc/docs/preparation/createaccount"},next:{title:"Install Lumos",permalink:"/lumos_doc/docs/tutorials/installlumos"}},i=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Environment",id:"environment",children:[]},{value:"Steps",id:"steps",children:[{value:"Download the Hello Lumos example.",id:"download-the-hello-lumos-example",children:[]},{value:"Install dependencies.",id:"install-dependencies",children:[]},{value:"Update the account information.",id:"update-the-account-information",children:[]},{value:"Build the project.",id:"build-the-project",children:[]},{value:"Enter the Node.js REPL mode.",id:"enter-the-nodejs-repl-mode",children:[]},{value:"Start the indexer and initialize the configurations.",id:"start-the-indexer-and-initialize-the-configurations",children:[]},{value:"Perform a common transfer transaction.",id:"perform-a-common-transfer-transaction",children:[]}]}],s={toc:i};function b(e){var t=e.components,n=Object(l.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The Hello Lumos example is designed to serve as the starting point for learning Lumos. "),Object(o.b)("p",null,"The  example has the following structure:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"hellolumos/\n\u251c\u2500\u2500 src|accounts.ts\n\u251c\u2500\u2500 src|buildTXs.ts\n\u251c\u2500\u2500 src|index.ts\n\u251c\u2500\u2500 src|managekeys.ts\n\u251c\u2500\u2500 src|querycells.ts\n\u251c\u2500\u2500 src|querytransactions.ts\n\u251c\u2500\u2500 config.json\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 yarn.lock\n")),Object(o.b)("p",null,"All required dependencies for the Hello Lumos example are listed in package.json. To install the other Lumos packages, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/installlumos"}),"Install Lumos"),"."),Object(o.b)("p",null,"The connection with the CKB node is established by the setup of the config manager and the Lumos indexer in the ",Object(o.b)("u",null,"index.ts")," file. The Lumos indexer indexes cells locally to provide cells for queries and transaction requests. For more information about setting up the config manager, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/config"}),"Set Up the Config Manger"),". For more information about setting up the Lumos indexer, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/indexer"}),"Set Up the Lumos Indexer"),"."),Object(o.b)("p",null,"The functions like querying on cells in ",Object(o.b)("u",null,"querycells.ts"),", building transactions in ",Object(o.b)("u",null,"buildTXs.ts")," are all facilitated based on the Lumos framework."),Object(o.b)("p",null,"The ",Object(o.b)("u",null,"querycells.ts")," file implements several sample functions by utilizing Lumos utilities for querying on cells. For more information, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/querycells"}),"Query on Cells"),"."),Object(o.b)("p",null,"The ",Object(o.b)("u",null,"querytransactions.ts")," file implements several sample functions by utilizing Lumos utilities for querying on transactions. For more information, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/querytransactions"}),"Query on Transactions"),"."),Object(o.b)("p",null,"The ",Object(o.b)("u",null,"buildTXs.ts")," file implements several sample functions by utilizing Lumos utilities for assembling common transfer transactions, DAO deposit and withdraw transactions. For more information, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/buildtransactions"}),"Assembling Transactions"),"."),Object(o.b)("p",null,"This guide will help you to get a general idea about the usage of Lumos through a common transaction. The full code of the example can be found here. "),Object(o.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(o.b)("p",null,"The following Prerequisites apply for walking through this guide:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"The development environment is set up. For more information, see ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"../preparation/setupsystem"}),"Set Up the Development Environment"),"."),Object(o.b)("li",{parentName:"ul"},"The CKB node is installed and started on DEV chain. For more information, see ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"../preparation/installckb"}),"Install a CKB Node"),"."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("ul",null,Object(o.b)("li",null,"Option 1: Install all the required tools and configurations using Microsoft's windows-build-tools by running ",Object(o.b)("code",null,"npm install -g windows-build-tools -vs2019")," from an elevated PowerShell (run as Administrator).",Object(o.b)("p",null,Object(o.b)("b",null,"Note"),": This command installs all the system dependencies without conflicting with any software already installed on the system. Depending on the build tools' version, the installation requires 3 to 8 gigabytes space to get all dependencies installed. It can take at least 30 minutes depending on the network connection.")),Object(o.b)("li",null,"Option 2: Install dependencies and configure the tools manually.",Object(o.b)("ul",null,Object(o.b)("li",null,"Install Visual C++ Build Environment: Tools for Visual Studio 2019 -> ",Object(o.b)("a",{href:"https://visualstudio.microsoft.com/downloads/"},"Visual Studio 2019 Build Tools"),' (using "Visual C++ build tools" workload) and run ',Object(o.b)("code",null,"npm config set msvs_version 2019")," in a cmd terminal."),Object(o.b)("li",null,"Install Python 2.7 (v3.x.x is not supported), and run ",Object(o.b)("code",null,"npm config set python /path/to/python2.7"),".")))))),Object(o.b)("h2",{id:"environment"},"Environment"),Object(o.b)("p",null,"The following examples are verified on Ubuntu 20.04.2. Steps on the other platforms are similar and can be adjusted accordingly."),Object(o.b)("h2",{id:"steps"},"Steps"),Object(o.b)("h3",{id:"download-the-hello-lumos-example"},"Download the Hello Lumos example."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ cd\n$ git clone https://github.com/nervosnetwork/hellolumos\n")),Object(o.b)("h3",{id:"install-dependencies"},"Install dependencies."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ cd hellolumos\n$ yarn install\n")),Object(o.b)("details",null,Object(o.b)("summary",null,"CLICK ME"),Object(o.b)("p",null,Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'yarn install v1.22.10\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@2.3.2: The platform "win32" is incompatible with this module.\ninfo "fsevents@2.3.2" is an optional dependency and failed compatibility check. Excluding it from installation.\n[3/4] Linking dependencies...\n[4/4] Building fresh packages...\nDone in 52.70s.\n')))),Object(o.b)("h3",{id:"update-the-account-information"},"Update the account information."),Object(o.b)("p",null,"Replace the value of ",Object(o.b)("inlineCode",{parentName:"p"},"PRIVATE_KEY"),", ",Object(o.b)("inlineCode",{parentName:"p"},"ADDRESS"),", ",Object(o.b)("inlineCode",{parentName:"p"},"ARGS")," and ",Object(o.b)("inlineCode",{parentName:"p"},"LOCKHASH")," for ALICE and BOB in the ",Object(o.b)("inlineCode",{parentName:"p"},"accounts.ts")," file with the account information you have prepared when creating accounts. For more information about creating accounts, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../preparation/createaccount"}),"Create Accounts"),"."),Object(o.b)("p",null,"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript",metastring:'title="hellolumos/src/accounts.ts"',title:'"hellolumos/src/accounts.ts"'}),'export const ALICE = {\n  PRIVATE_KEY:\n    "0xf2a91b1410f7308631b89603262448ba515cddac1ffe250265551c82fff3eb3a",\n  ADDRESS: "ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf",\n  ARGS: "0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e",\n  LOCKHASH: "0xf6ea009a4829de7aeecd75f3ae6bcdbaacf7328074ae52a48456a8793a4b1cca"\n};\n\nexport const BOB = {\n  PRIVATE_KEY:\n    "0x670ac6ac1ce8004b4220f0fb024179461f11989ff4d446816f78813b80b9c696",\n  ADDRESS: "ckt1qyqwe03shn6udvhjmrkzm53f53sr5l3qdwvsytj4hs",\n  ARGS: "0xecbe30bcf5c6b2f2d8ec2dd229a4603a7e206b99",\n  LOCKHASH: "0x34f085b5d2fa3f4ad2880713082a72864522a6ebffa1eb931b09e0407092eda5",\n};\n')),Object(o.b)("h3",{id:"build-the-project"},"Build the project."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ tsc\n")),Object(o.b)("h3",{id:"enter-the-nodejs-repl-mode"},"Enter the Node.js REPL mode."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ node --experimental-repl-await\n")),Object(o.b)("details",null,Object(o.b)("summary",null,"CLICK ME"),Object(o.b)("p",null,Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'Welcome to Node.js v14.0.0.\nType ".help" for more information.\n')))),Object(o.b)("h3",{id:"start-the-indexer-and-initialize-the-configurations"},"Start the indexer and initialize the configurations."),Object(o.b)("p",null,"The following code snippet starts the Lumos indexer and sets up the config manager."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript",metastring:'title="hellolumos/src/index.ts"',title:'"hellolumos/src/index.ts"'}),'import { Indexer } from "@ckb-lumos/indexer";\nexport const INDEXER = new Indexer(CKB_RPC, "./indexed-data");\nINDEXER.startForever();\n\nimport { getConfig, initializeConfig } from "@ckb-lumos/config-manager";\nenv.LUMOS_CONFIG_FILE = env.LUMOS_CONFIG_FILE || "./config.json";\ninitializeConfig();\nexport const CONFIG = getConfig();\n')),Object(o.b)("p",null,"Run the code in the Node.js REPL mode:"),Object(o.b)("details",null,Object(o.b)("summary",null,"CLICK ME"),Object(o.b)("p",null,Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'> require(".");\nThe server is started.\n')))),Object(o.b)("h3",{id:"perform-a-common-transfer-transaction"},"Perform a common transfer transaction."),Object(o.b)("p",null,"Step 1. Get the lock script for the accounts of Alice and Bob."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'> const alice = accounts.ALICE;\n> const bob = accounts.BOB;\n> const { parseAddress }=require("@ckb-lumos/helpers");\n> const script1 = parseAddress(alice.ADDRESS);\n> const script2 = parseAddress(bob.ADDRESS);\n> console.log(script1);\n')),Object(o.b)("details",null,Object(o.b)("summary",null,"CLICK ME"),Object(o.b)("p",null,Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"{\n  code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n  hash_type: 'type',\n  args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n}\n")))),Object(o.b)("p",null,"Step 2. Get the balance for the accounts of Alice and Bob."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"> const balance1 = querycells.getBalancebyLock(script1);\n> The balance of the account is 1386763373620166n\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"> const balance2 = querycells.getBalancebyLock(script2);\n> The balance of the account is 0n\n")),Object(o.b)("p",null,"Step 3. Assemble a common transfer transaction. "),Object(o.b)("p",null,"The buildCommonTx() function performs the following actions: "),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Create a new ",Object(o.b)("inlineCode",{parentName:"li"},"TransactionSkeleton")," for the transfer action with the ",Object(o.b)("inlineCode",{parentName:"li"},"common.transfer")," function."),Object(o.b)("li",{parentName:"ul"},"Add the pay fee for the transaction with the ",Object(o.b)("inlineCode",{parentName:"li"},"common.payFee")," function."),Object(o.b)("li",{parentName:"ul"},"Prepare signing entries with the ",Object(o.b)("inlineCode",{parentName:"li"},"common.prepareSigningEntries")," function."),Object(o.b)("li",{parentName:"ul"},"Sign and seal the transaction with the ",Object(o.b)("inlineCode",{parentName:"li"},"signandSeal")," function."),Object(o.b)("li",{parentName:"ul"},"Send the transaction with the ",Object(o.b)("inlineCode",{parentName:"li"},"rpc.send_transaction")," function. ")),Object(o.b)("p",null,"For more information about assembling a transaction, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/buildtransactions"}),"Assemble Transactions"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"> const txskeleton = await buildTXs.buildCommonTx(alice.ADDRESS, bob.ADDRESS,20000000000n,10000000n,alice.PRIVATE_KEY);\nThe transaction hash is 0x10104ec6857fd99b818e7b401216268c067ce7fbc536b77c86f3565c108e958e\n")),Object(o.b)("p",null,"Step 4. Check the transaction status."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"The CKB miner must be started to enable the transaction to be committed. For more information about transaction status, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../tutorials/querytransactions#get-transaction-status-and-block-hash"}),"Get Transaction Status and Block Hash"),".")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'> await querytransactions.getTXbyHash("0x10104ec6857fd99b818e7b401216268c067ce7fbc536b77c86f3565c108e958e");\nThe transaction status is pending\n')),Object(o.b)("p",null,"Step 5. Check the new balance of Bob."),Object(o.b)("p",null,"When the transaction is committed, the new balance appears in the result."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"> await querycells.getBalancebyLock(script2);\n> The balance of the account is 20000000000n\n")))}b.isMDXComponent=!0}}]);