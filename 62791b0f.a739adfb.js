(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{110:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return u}));var a=t(0),r=t.n(a);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),b=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=b(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},p=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,c=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=b(t),p=a,u=d["".concat(o,".").concat(p)]||d[p]||f[p]||c;return t?r.a.createElement(u,i(i({ref:n},l),{},{components:t})):r.a.createElement(u,i({ref:n},l))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var c=t.length,o=new Array(c);o[0]=p;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var l=2;l<c;l++)o[l]=t[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},81:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return b}));var a=t(3),r=t(7),c=(t(0),t(110)),o={id:"querytransactions",title:"Query on Transactions"},i={unversionedId:"tutorials/querytransactions",id:"tutorials/querytransactions",isDocsHomePage:!1,title:"Query on Transactions",description:"Transactions are the most fundamental entities for interacting with Nervos CKB.",source:"@site/docs\\tutorials\\querytransactions.md",slug:"/tutorials/querytransactions",permalink:"/lumos_doc/docs/tutorials/querytransactions",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/tutorials/querytransactions.md",version:"current",sidebar:"someSidebar",previous:{title:"Query on Cells",permalink:"/lumos_doc/docs/tutorials/cells"},next:{title:"Assemble Transactions",permalink:"/lumos_doc/docs/tutorials/buildtransactions"}},s=[{value:"Data Structure",id:"data-structure",children:[{value:"Description",id:"description",children:[]},{value:"A Transaction Example",id:"a-transaction-example",children:[]}]},{value:"Examples",id:"examples",children:[{value:"Query Transactions Related to a Lock Script",id:"query-transactions-related-to-a-lock-script",children:[]},{value:"Query Transactions between Given Block Numbers",id:"query-transactions-between-given-block-numbers",children:[]},{value:"Skip Transactions",id:"skip-transactions",children:[]},{value:"Order Transactions by Block Number",id:"order-transactions-by-block-number",children:[]},{value:"Prefix Search on <code>args</code>",id:"prefix-search-on-args",children:[]},{value:"Fine Grained Query for Transactions",id:"fine-grained-query-for-transactions",children:[]}]}],l={toc:s};function b(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("p",null,"Transactions are the most fundamental entities for interacting with Nervos CKB. "),Object(c.b)("h2",{id:"data-structure"},"Data Structure"),Object(c.b)("h3",{id:"description"},"Description"),Object(c.b)("p",null,"A transaction includes the following fields:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"deps"),": Dependent cell set, provides read-only cells required by transaction verification. These must be references to living cells."),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"inputs"),": Cell references and proofs. Cell references point to live cells that are transferred or updated in the transaction. Proofs (e.g., signature) prove that the transaction creator has the permission to transfer or update the referenced cells."),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"outputs"),": New cells created in this state transition.")),Object(c.b)("p",null,"For more information about CKB transactions, see ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.nervos.org/docs/reference/transaction#docsNav"}),"Transaction")," and ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md#44-transaction"}),"CKB RFC"),"."),Object(c.b)("h3",{id:"a-transaction-example"},"A Transaction Example"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "version": "0x0",\n  "cell_deps": [\n    {\n      "out_point": {\n        "tx_hash": "0xbd864a269201d7052d4eb3f753f49f7c68b8edc386afc8bb6ef3e15a05facca2",\n        "index": "0x0"\n      },\n      "dep_type": "dep_group"\n    }\n  ],\n  "header_deps": [\n    "0xaa1124da6a230435298d83a12dd6c13f7d58caf7853f39cea8aad992ef88a422"\n  ],\n  "inputs": [\n    {\n      "previous_output": {\n        "tx_hash": "0x8389eba3ae414fb6a3019aa47583e9be36d096c55ab2e00ec49bdb012c24844d",\n        "index": "0x1"\n      },\n      "since": "0x0"\n    }\n  ],\n  "outputs": [\n    {\n      "capacity": "0x746a528800",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "args": "0x56008385085341a6ed68decfabb3ba1f3eea7b68",\n        "hash_type": "type"\n      },\n      "type": null\n    },\n    {\n      "capacity": "0x1561d9307e88",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "args": "0x886d23a7858f12ebf924baaacd774a5e2cf81132",\n        "hash_type": "type"\n      },\n      "type": null\n    }\n  ],\n  "outputs_data": [\n    "0x",\n    "0x"\n  ],\n  "witnesses": ["0x55000000100000005500000055000000410000004a975e08ff99fa0001\n    42ff3b86a836b43884b5b46f91b149f7cc5300e8607e633b7a29c94dc01c6616a12f62e74a1\n    415f57fcc5a00e41ac2d7034e90edf4fdf800"\n  ]\n}\n')),Object(c.b)("h2",{id:"examples"},"Examples"),Object(c.b)("h3",{id:"query-transactions-related-to-a-lock-script"},"Query Transactions Related to a Lock Script"),Object(c.b)("p",null,"To query transactions related to a lock script:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash:\n      "0x0000000000000000000000000000000000000000000000000000000000000000",\n    hash_type: "data",\n    args: "0x62e907b15cbf27d5425399ebf6f0fb50ebb88f18",\n  },\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("h3",{id:"query-transactions-between-given-block-numbers"},"Query Transactions between Given Block Numbers"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x0", // "0x" + 0n.toString(16) \n  toBlock: "0x7d0" , // "0x" + 2000n.toString(16)\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("p",null,"It will fetch transactions between ",Object(c.b)("inlineCode",{parentName:"p"},"[fromBlock, toBlock]"),", which means both ",Object(c.b)("inlineCode",{parentName:"p"},"fromBlock")," and ",Object(c.b)("inlineCode",{parentName:"p"},"toBlock")," are included in query range."),Object(c.b)("h3",{id:"skip-transactions"},"Skip Transactions"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  skip: 100,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"skip")," field represents the number of transactions being skipped, which in the above code snippet means it would skip the first 100 transactions and return from the 101st one."),Object(c.b)("h3",{id:"order-transactions-by-block-number"},"Order Transactions by Block Number"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df323",\n  },\n  fromBlock: "0x4e20", // "0x" + 20000n.toString(16)\n  toBlock: "0x5208", // "0x" + 21000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 10,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("h3",{id:"prefix-search-on-args"},"Prefix Search on ",Object(c.b)("inlineCode",{parentName:"h3"},"args")),Object(c.b)("p",null,"The default ",Object(c.b)("inlineCode",{parentName:"p"},"argsLen")," is -1, which means you pass the full slice of original args, and you can specify it when the ",Object(c.b)("inlineCode",{parentName:"p"},"args")," field is the prefix of original args."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7df3", // truncate the last byte of orignal args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: 20, // default option is -1\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("p",null,"We recommend to specify explicit length for the ",Object(c.b)("inlineCode",{parentName:"p"},"argsLen")," field. For example, the length is 20 in normal scenario and 28 in multisig scenario for lock script.  When the length is not certain, the ",Object(c.b)("inlineCode",{parentName:"p"},"argsLen")," field can be set as ",Object(c.b)("inlineCode",{parentName:"p"},"any"),". But there is performance lost when use ",Object(c.b)("inlineCode",{parentName:"p"},"any")," rather than explicitly specified length."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    code_hash: \n      "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    hash_type: "type",\n    args: "0xa528f2b9a51118b193178db4cf2f3db92e7d", // truncate the last two bytes of original args: 0xa528f2b9a51118b193178db4cf2f3db92e7df323\n  },\n  argsLen: "any",\n  fromBlock: "0x253b40", // "0x" + 2440000n.toString(16)\n  toBlock: "0x253f28", // "0x" + 2441000n.toString(16)\n  order: "desc", // default option is "asc"\n  skip: 300,\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("h3",{id:"fine-grained-query-for-transactions"},"Fine Grained Query for Transactions"),Object(c.b)("p",null,"Fine Grained Query for Transactions can be achieved by using ",Object(c.b)("inlineCode",{parentName:"p"},"ScriptWrapper")," with customized options like ",Object(c.b)("inlineCode",{parentName:"p"},"ioType"),", ",Object(c.b)("inlineCode",{parentName:"p"},"argsLen"),":"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'txCollector = new TransactionCollector(indexer, {\n  lock: {\n    script: {\n      code_hash: \n        "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n      hash_type: "type",\n      args: "0xe60f7f88c94ef365d540afc1574c46bb017765", // trucate the last byte of original args: 0xe60f7f88c94ef365d540afc1574c46bb017765a2\n    },\n    ioType: "both",\n    argsLen: 20, // when the `argsLen` is not setted here, it will use the outside `argsLen` config\n  },\n  type: {\n    script: {\n      code_hash: "0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e",\n      hash_type: "type",\n      args: "0x",\n    },\n    ioType: "input",\n  }\n});\n\nfor await (const tx of txCollector.collect()) {\n  console.log(tx);\n}\n')),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"ioType")," field is among ",Object(c.b)("inlineCode",{parentName:"p"},"input | output | both"),"."))}b.isMDXComponent=!0}}]);