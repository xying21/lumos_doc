(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{110:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),b=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=b(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=b(n),m=a,h=p["".concat(c,".").concat(m)]||p[m]||d[m]||s;return n?o.a.createElement(h,r(r({ref:t},l),{},{components:n})):o.a.createElement(h,r({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,c=new Array(s);c[0]=m;var r={};for(var i in t)hasOwnProperty.call(t,i)&&(r[i]=t[i]);r.originalType=e,r.mdxType="string"==typeof e?e:a,c[1]=r;for(var l=2;l<s;l++)c[l]=n[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},111:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c}));var a=n(22),o=n(114);function s(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(a.default)();return{withBaseUrl:(n,a)=>function(e,t,n,{forcePrependBaseUrl:a=!1,absolute:s=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if(Object(o.b)(n))return n;if(a)return t+n;const c=n.startsWith(t)?n:t+n.replace(/^\//,"");return s?e+c:c}(t,e,n,a)}}function c(e,t={}){const{withBaseUrl:n}=s();return n(e,t)}},114:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function o(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}))},87:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),s=(n(0),n(110)),c=n(111),r={id:"buildtransactions",title:"Build Transactions"},i={unversionedId:"guides/buildtransactions",id:"guides/buildtransactions",isDocsHomePage:!1,title:"Build Transactions",description:"The objective and the core functionality of a DApp built on top of Lumos is to build transactions in response to user requests. Lumos provides the TransactionSkeleton that significantly simplifies the transaction assembling process. Each transaction skeleton corresponds to an action, and will be built into a single transaction that is ready to be submitted to CKB.",source:"@site/docs\\guides\\buildTransactions.md",slug:"/guides/buildtransactions",permalink:"/lumos_doc/docs/guides/buildtransactions",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/guides/buildTransactions.md",version:"current",lastUpdatedAt:1623742154,sidebar:"sidebar2",previous:{title:"Query on Transactions",permalink:"/lumos_doc/docs/guides/querytransactions"},next:{title:"Manage Accounts",permalink:"/lumos_doc/docs/guides/manageaccounts"}},l=[{value:"General Workflow",id:"general-workflow",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Environment",id:"environment",children:[]},{value:"Examples",id:"examples",children:[{value:"Transfer CKB in a Common Transaction",id:"transfer-ckb-in-a-common-transaction",children:[]},{value:"Deposit CKB to DAO",id:"deposit-ckb-to-dao",children:[]},{value:"List DAO Cells",id:"list-dao-cells",children:[]},{value:"Withdraw a Cell from Nervos DAO",id:"withdraw-a-cell-from-nervos-dao",children:[]},{value:"Unlock a Withdrawn Cell",id:"unlock-a-withdrawn-cell",children:[]},{value:"Transfer CKB with Locktime Pool",id:"transfer-ckb-with-locktime-pool",children:[]},{value:"Issue SUDT Tokens",id:"issue-sudt-tokens",children:[]},{value:"Transfer SUDT Tokens",id:"transfer-sudt-tokens",children:[]}]}],b={toc:l};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(s.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"The objective and the core functionality of a DApp built on top of Lumos is to build transactions in response to user requests. Lumos provides the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/helpers.html#transactionskeletontype"},"TransactionSkeleton")," that significantly simplifies the transaction assembling process. Each transaction skeleton corresponds to an action, and will be built into a single transaction that is ready to be submitted to CKB."),Object(s.b)("p",null,"This guide introduces the general workflow of assembling transactions. The workflow applies to the following examples of a common transfer operation, DAO operations, a transfer operation with the ",Object(s.b)("inlineCode",{parentName:"p"},"locktimepool"),", and SUDT operations."),Object(s.b)("h2",{id:"general-workflow"},"General Workflow"),Object(s.b)("p",null,"The DApp can assemble a transaction in the following steps:"),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp creates a transaction skeleton"),".")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp adds the fee for the transaction"),". The sender or someone other than the sender can pay the fee. ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp prepares the signing entries"),". The signing entries are the data that the user's wallet needs to sign to provide valid witnesses for the input lock scripts. ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp acquires the signature from a user wallet"),"."),Object(s.b)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"From the security perspective of a DApp, Lumos does not support built-in message signing. So the DApp needs to send the raw transaction "," to the user wallet to acquire signatures. The raw transaction contains all the cells and dependencies for the action and the data that needs to be signed."," ")))),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp seals the transaction.")," The transaction with signatures is forwarded to the DApp. The DApp seals the transaction by adding the transaction signatures to the transaction structure. ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"The DApp forwards this finalized transaction to the CKB network"),". The DApp forwards the sealed transaction to the CKB network through the RPC interface. Upon successful receipt, the CKB network returns the transaction hash to the DApp. The transaction hash is sent back to the client such that the client can track the transactions.")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"(Optional) The DApp gets the transaction status.")))),Object(s.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(s.b)("p",null,"The following prerequisites apply for the examples in this guide:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"The development environment is set up. For more information, see ",Object(s.b)("a",{parentName:"li",href:"http://localhost:3000/lumos_doc/docs/preparation/setupsystem"},"Set Up the Development Environment"),"."),Object(s.b)("li",{parentName:"ul"},"The Lumos packages are installed. For more information, see ",Object(s.b)("a",{parentName:"li",href:"../guides/installlumos"},"Install Lumos Packages"),".")),Object(s.b)("h2",{id:"environment"},"Environment"),Object(s.b)("p",null,"The following examples are verified on Ubuntu 20.04.2. Steps on the other platforms can be adjusted accordingly."),Object(s.b)("h2",{id:"examples"},"Examples"),Object(s.b)("h3",{id:"transfer-ckb-in-a-common-transaction"},"Transfer CKB in a Common Transaction"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"@ckb-lumos/common-scripts")," package includes a ",Object(s.b)("inlineCode",{parentName:"p"},"common")," script that can transfer capacity from ",Object(s.b)("inlineCode",{parentName:"p"},"fromInfos")," to an address, add the transaction fee and prepare signing entries for the transaction."),Object(s.b)("h4",{id:"step-1-create-a-transaction-skeleton"},Object(s.b)("strong",{parentName:"h4"},"Step 1. Create a transaction skeleton.")),Object(s.b)("p",null,"The following example firstly creates a new transaction skeleton with the Lumos indexer as the cell provider ",Object(s.b)("inlineCode",{parentName:"p"},"TransactionSkeleton({cellProvider: INDEXER})")," that provides cells for assembling the transaction. "),Object(s.b)("p",null,"Then the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#transfer-15"},"common.transfer")," function is used to add the input cells and output cells to the transaction skeleton according to the specified parameters."),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/commonTransfer"',title:'"hellolumos/src/buildTXs.ts/commonTransfer"'},"let txSkeleton: TransactionSkeletonType = TransactionSkeleton({\n  cellProvider: INDEXER,\n});\nconst tipheader = await rpc.get_tip_header();\n\ntxSkeleton = await common.transfer(\n  txSkeleton,\n  fromInfos,\n  toAddress,\n  BigInt(amount),\n  undefined,\n  tipheader\n);\n")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#transfer-15"},"common.transfer")," function creates a common transfer transaction."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"common.transfer(\n    txSkeleton: TransactionSkeletonType, \n    fromInfos: FromInfo[], \n    toAddress: Address,  \n    amount: bigint, \n    changeAddress?: Address, \n    tipHeader?: Header, \n    {  \n        config = undefined,  \n        useLocktimeCellsFirst = true,  \n        LocktimePoolCellCollector = locktimePool.CellCollector,\n    }: {   config?: Config;   useLocktimeCellsFirst?: boolean;  LocktimePoolCellCollector?: any;  } = {}\n)\n")),Object(s.b)("p",null,"Lumos supports gathering input cells from multiple wallets as a single unit by using the ",Object(s.b)("var",null,"fromInfos")," parameter. It is a array of wallet parameters of a ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/common_scripts.multisigscript.html"},"MultisigScript"),", Address (string), ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/common_scripts.acp.html"},"ACP")," or ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/common_scripts.customscript.html"},"CustomScript")," type. MultisigScript is used for the secp256k1_blake160_multisig lock script (the transactions that require multi-signatures)."),Object(s.b)("p",null,"The MultisigScript requires the following parameters:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("var",null,"M"),": ",Object(s.b)("b",null,"M")," of N signatures must be provided to unlock the cell. ",Object(s.b)("b",null,"N")," equals to the size of ",Object(s.b)("var",null,"publicKeyHashes"),". ",Object(s.b)("var",null,"M")," is a single byte unsigned integer that ranges from 0 to 255."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("var",null,"R"),": The provided signatures must match at least the first ",Object(s.b)("b",null,"R")," items of the Pubkey list. ",Object(s.b)("var",null,"R")," is a single byte unsigned integer that ranges from 0 to 255."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("var",null,"publicKeyHashes"),": The list of Lock Args generated by the blake160 function that extracts the first 20 bytes of a public key hash.")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"export interface MultisigScript {\n  R: number;\n  M: number;\n  publicKeyHashes: Hash[];\n  /** locktime in since format */\n  since?: PackedSince;\n}\n")),Object(s.b)("p",null,"The following MultisigScript example means that any one of Alice and Bob can unlock the cell, but Alice must approve the transaction (1 is assigned to R)."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},'const fromInfo = {\n  R: 1,\n  M: 1,\n  publicKeyHashes: [\n    "0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e", //Lock Arg of Alice\n    "0xecbe30bcf5c6b2f2d8ec2dd229a4603a7e206b99", // Lock Arg of Bob\n  ],\n};\n')),Object(s.b)("p",null,"If ",Object(s.b)("var",null,"changeAddress")," is not specified in the ",Object(s.b)("inlineCode",{parentName:"p"},"common.transfer")," function, the first element of ",Object(s.b)("var",null,"fromInfos")," is used as the change address. "),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"common.transfer")," function can use cells with lock period in priority over other cells by specifying ",Object(s.b)("var",null,"tipHeader")," in the ",Object(s.b)("inlineCode",{parentName:"p"},"transfer")," function."),Object(s.b)("p",null,"To use the cells without lock period, just use ",Object(s.b)("inlineCode",{parentName:"p"},"undefined")," for ",Object(s.b)("var",null,"tipHeader")," or specify the ",Object(s.b)("var",null,"useLocktimeCellsFirst")," parameter as false."),Object(s.b)("h4",{id:"step-2-add-the-fee-for-the-transaction"},Object(s.b)("strong",{parentName:"h4"},"Step 2. Add the fee for the transaction.")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#payfee-11"},"common.payFee")," function can be used to add the transaction fee to the transaction skeleton."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"common.payFee(\n  txSkeleton: TransactionSkeletonType,\n  fromInfos: FromInfo[],\n  amount: bigint,\n  tipHeader?: Header,\n  {\n    config = undefined,\n    useLocktimeCellsFirst = true,\n    enableDeductCapacity = true,\n  }: {\n    config?: Config;\n    useLocktimeCellsFirst?: boolean;\n    enableDeductCapacity?: boolean;\n  } = {}\n)\n")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#payfee-11"},"common.payFee"),"  function can use cells with lock period in priority over other cells by specifying ",Object(s.b)("var",null,"tipHeader")," in the function."),Object(s.b)("p",null,"To use the cells without lock period, just use ",Object(s.b)("inlineCode",{parentName:"p"},"undefined")," for ",Object(s.b)("var",null,"tipHeader")," or specify the ",Object(s.b)("var",null,"useLocktimeCellsFirst")," parameter as false."),Object(s.b)("p",null,"The following example uses the cells without lock period to add the pay fee to the transaction skeleton created from Step 1."),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/commonTransfer"',title:'"hellolumos/src/buildTXs.ts/commonTransfer"'},"txSkeleton = await common.payFee(txSkeleton, fromInfos, BigInt(txFee));\n")),Object(s.b)("h4",{id:"step-3-prepare-the-signing-entries"},Object(s.b)("strong",{parentName:"h4"},"Step 3. Prepare the signing entries.")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#preparesigningentries-16"},"common.prepareSigningEntries")," function is used to add the signing entries to the transaction skeleton. The result is a raw transaction that requires signatures."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"common.prepareSigningEntries(\n  txSkeleton: TransactionSkeletonType,\n  { config = undefined }: Options = {}\n)\n")),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/commonTransfer"',title:'"hellolumos/src/buildTXs.ts/commonTransfer"'},"skeleton = common.prepareSigningEntries(txSkeleton);\n")),Object(s.b)("h4",{id:"step-4-sign-and-seal-the-transaction"},Object(s.b)("strong",{parentName:"h4"},"Step 4. Sign and seal the transaction.")),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"Lumos does not support built-in message signing. The DApp needs to send the raw transaction to the user wallet to acquire signatures. "))),Object(s.b)("p",null,"For simplicity and demonstration, this example uses the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/hd.html#signrecoverable-3"},"key.signRecoverable")," function of the HD wallet manager (@ckb-lumos/hd) package to generate a signature based on the private key of the account. "),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/signandSeal" {9,10}',title:'"hellolumos/src/buildTXs.ts/signandSeal"',"{9,10}":!0},'import { key } from "@ckb-lumos/hd";\nimport { sealTransaction } from "@ckb-lumos/helpers";\n\nexport async function signandSeal(\n  txskeleton: TransactionSkeletonType,\n  privatekey: string\n): Promise<Transaction> {\n  const message = txskeleton.get("signingEntries").get(0)?.message;\n  const Sig = key.signRecoverable(message!, privatekey);\n  const tx = sealTransaction(txskeleton, [Sig]);\n  return tx;\n}\n')),Object(s.b)("p",null,"The following is a signature output example\uff1a"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash",metastring:"{1-3}","{1-3}":!0},"[  \n'0x4f73f26e51bee76d89edb74aee20e6fb2f8c670881f087aba04be80d7bd05117579d2bcfea3618d55473504e06586c10eecb76169d2ef0849c72e50a2f5d2b9500'\n]\n")),Object(s.b)("p",null,"To seal the transaction, the example uses the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/helpers.html#sealtransaction"},"sealTransaction")," function of the ",Object(s.b)("inlineCode",{parentName:"p"},"@ckb-lumos/helpers")," package to add the transaction signatures to the transaction skeleton."),Object(s.b)("h4",{id:"step-5-send-this-finalized-transaction-to-the-ckb-network"},Object(s.b)("strong",{parentName:"h4"},"Step 5. Send this finalized transaction to the CKB network.")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/classes/rpc.rpc-2.html#send_transaction"},"send_transaction")," function of the ",Object(s.b)("inlineCode",{parentName:"p"},"@ckb-lumos/rpc")," package can be used to send the transaction to the CKB network. The function sends the transaction to chain and returns a hash for the transaction. The hash can then be used to track the transactions."),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/commonTransfer" {3}',title:'"hellolumos/src/buildTXs.ts/commonTransfer"',"{3}":!0},'import { RPC } from "@ckb-lumos/rpc";\nconst rpc = new RPC("http://127.0.0.1:8114");\nconst hash = await rpc.send_transaction(tx);\nconsole.log("The transaction hash is", hash);\n')),Object(s.b)("p",null,"Instead of the ",Object(s.b)("inlineCode",{parentName:"p"},"RPC.send_transaction")," function, the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/classes/transaction_manager.transactionmanager.html#send_transaction"},"TransactionManager.send_transaction")," function supports validation on the transaction before sending the transaction to the CKB network. The function checks whether spent cells are used as input cells in the transaction. If any spent cell is used, it will throw an error. If no spent cells is used, the function will send the transaction to the CKB network and return the transaction hash as the result."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:"{1}","{1}":!0},'const hash = await transactionManager.send_transaction(tx);\nconsole.log("The transaction hash is", hash);\n')),Object(s.b)("p",null,"A transaction hash output example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1}","{1}":!0},"0x10104ec6857fd99b818e7b401216268c067ce7fbc536b77c86f3565c108e958e\n")),Object(s.b)("div",{className:"admonition admonition-info alert alert--info"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"The earlier versions before 0.16.0 require the Anyone-Can-Pay (ACP) script for submitting transactions. If you fail to submit transactions because of missing the ACP script, you can upgrade Lumos to the latest version, or copy a dummy script into the config.json file under the root of the DApp project to fix the error."))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Step 6. (Optional) Get the Transaction Status.")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/classes/rpc.rpc-2.html#get_transaction"},"get_transaction")," function of the ",Object(s.b)("inlineCode",{parentName:"p"},"@ckb-lumos/rpc")," package can be used to get the transaction with status. "),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/commonTransfer()" {3}',title:'"hellolumos/src/buildTXs.ts/commonTransfer()"',"{3}":!0},'import { RPC } from "@ckb-lumos/rpc";\nconst rpc = new RPC("http://127.0.0.1:8114");\nconst txWithStatus = await rpc.get_transaction(hash);\nconsole.log("Transaction status is:", txWithStatus.tx_status.status);\n')),Object(s.b)("h3",{id:"deposit-ckb-to-dao"},"Deposit CKB to DAO"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"Nervos DAO is a smart contract. Users can interact the same way as any smart contract on CKB with Nervos DAO. One function of Nervos DAO is to provide an dilution counter-measure for CKByte holders. By deposit in Nervos DAO, holders get proportional secondary rewards, which guarantee their holding are only affected by hardcapped primary issuance as in Bitcoin. For more information about Nervos DAO, see ",Object(s.b)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0023-dao-deposit-withdraw/0023-dao-deposit-withdraw.md"},"CKB RFC: Nervos DAO"),".")),Object(s.b)("h4",{id:"step-1-create-a-transaction-skeleton-with-the-dao-script"},Object(s.b)("strong",{parentName:"h4"},"Step 1. Create a transaction skeleton with the DAO script.")),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#deposit-2"},"dao.deposit")," is used to deposit CKB to DAO. The deposited cells are frozen after the deposit operation."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"dao.deposit(\n  txSkeleton: TransactionSkeletonType,\n  fromInfo: FromInfo,\n  toAddress: Address,\n  amount: bigint,\n  { config = undefined }: Options = {}\n)\n")),Object(s.b)("p",null,"The ",Object(s.b)("var",null,"fromInfo")," parameter must be specified when it is a ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/interfaces/common_scripts.multisigscript.html"},"MultisigScript")," script. The same address can be used as the ",Object(s.b)("inlineCode",{parentName:"p"},"fromInfo")," and ",Object(s.b)("inlineCode",{parentName:"p"},"toAddress")," in the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#deposit-2"},"dao.deposit")," function."),Object(s.b)("p",null,"The following example creates a transaction skeleton for the deposit action with the cells provided by the indexer. "),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/deposit2DAO" {5}',title:'"hellolumos/src/buildTXs.ts/deposit2DAO"',"{5}":!0},'let skeleton: TransactionSkeletonType = TransactionSkeleton({\n  cellProvider: INDEXER,\n});\nconsole.log("Deposit to DAO transaction");\nskeleton = await dao.deposit(skeleton, fromInfo, toAddress, BigInt(amount));\n')),Object(s.b)("p",null,"Use the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/helpers.html#createtransactionfromskeleton-1"},"createTransactionFromSkeleton")," function to view the current skeleton. "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/deposit2DAO" {2}',title:'"hellolumos/src/buildTXs.ts/deposit2DAO"',"{2}":!0},'import { createTransactionFromSkeleton } from "@ckb-lumos/helpers";\nconsole.log(JSON.stringify(createTransactionFromSkeleton(skeleton), null, 2));\n')),Object(s.b)("h4",{id:"step-2-add-the-fee-for-the-deposit-transaction"},Object(s.b)("strong",{parentName:"h4"},"Step 2. Add the fee for the deposit transaction.")),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"secp256k1_blake160"),", ",Object(s.b)("inlineCode",{parentName:"p"},"secp256k1_blake160_multisig")," and ",Object(s.b)("inlineCode",{parentName:"p"},"locktime_pool")," script are similar to the ",Object(s.b)("inlineCode",{parentName:"p"},"common")," script. It is recommended to use the ",Object(s.b)("inlineCode",{parentName:"p"},"common")," script to deal with those lock scripts for the ",Object(s.b)("inlineCode",{parentName:"p"},"payFee")," action and the ",Object(s.b)("inlineCode",{parentName:"p"},"prepareSigningEntries")," action."),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"deposit")," action and the ",Object(s.b)("inlineCode",{parentName:"p"},"payFee")," action are using the same address in the example. If you checked the transaction skeleton after incurring fees, you can notice that the transaction skeleton has only one input for the two actions. Lumos can intelligently rewrite the change cells generated in the deposit action to pay enough transaction fee. "),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/deposit2DAO" {1}',title:'"hellolumos/src/buildTXs.ts/deposit2DAO"',"{1}":!0},"skeleton = await common.payFee(skeleton, [fromInfo], BigInt(txFee));\n")),Object(s.b)("h4",{id:"step-3-prepare-the-signing-entries-1"},Object(s.b)("strong",{parentName:"h4"},"Step 3. Prepare the signing entries.")),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/deposit2DAO" {1}',title:'"hellolumos/src/buildTXs.ts/deposit2DAO"',"{1}":!0},"skeleton = common.prepareSigningEntries(skeleton);\n")),Object(s.b)("p",null,"This example loops through the skeleton, and creates ",Object(s.b)("inlineCode",{parentName:"p"},"signingEntries")," by using the ",Object(s.b)("inlineCode",{parentName:"p"},"common")," script."),Object(s.b)("h4",{id:"step-4-sign-and-seal-the-transaction-1"},Object(s.b)("strong",{parentName:"h4"},"Step 4. Sign and seal the transaction.")),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"Lumos does not support built-in message signing. The DApp needs to send the raw transaction to the user wallet to acquire signatures. "))),Object(s.b)("p",null,"For simplicity and demonstration, the example uses the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/hd.html#signrecoverable-3"},"key.signRecoverable")," function of the HD wallet manager (",Object(s.b)("inlineCode",{parentName:"p"},"@ckb-lumos/hd"),") to generate a signature based on the private key of the account. "),Object(s.b)("p",null,"For more information, see Step 4 in the common transaction section."),Object(s.b)("h4",{id:"step-5-send-this-finalized-transaction-to-the-ckb-network-1"},Object(s.b)("strong",{parentName:"h4"},"Step 5. Send this finalized transaction to the CKB network")),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/deposit2DAO" {1}',title:'"hellolumos/src/buildTXs.ts/deposit2DAO"',"{1}":!0},'const hash = await rpc.send_transaction(tx);\nconsole.log("The transaction hash is", hash);\nreturn hash;\n')),Object(s.b)("p",null,"The following is a deposit transaction hash output example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell"},"The transaction hash is 0x655bac89e443db42d48644f9fd89ddee70691f8e39ee4635c313375e8b2e6c0a\n")),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"deposit2DAO")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7,8}","{1,2,5,7,8}":!0},'$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType ".help" for more information.\n> const { accounts, buildTXs } = require(".");\nThe server is started.\n> const alice = accounts.ALICE;\n> await buildTXs.deposit2DAO(alice.ADDRESS, alice.ADDRESS, 20000000000n, 10000000n, alice.PRIVATE_KEY);\nDeposit to DAO transaction\n[warn] ANYONE_CAN_PAY script info not found in config!\n1\n1\n{\n  "version": "0x0",\n  "cell_deps": [\n    {\n      "out_point": {\n        "tx_hash": "0xb57669e3d40cdb3b4246e5e696307bfb46355dea6a9ba57d839860be101abf9a",\n        "index": "0x2"\n      },\n      "dep_type": "code"\n    },\n    {\n      "out_point": {\n        "tx_hash": "0x6ddc6718014b7ad50121b95bb25ff61b4445b6c57ade514e7d08447e025f9f30",\n        "index": "0x0"\n      },\n      "dep_type": "dep_group"\n    }\n  ],\n  "header_deps": [],\n  "inputs": [\n    {\n      "since": "0x0",\n      "previous_output": {\n        "tx_hash": "0x439c19db1367dfa9dd3fe105c3ae66a88520c58f7bf699ff45a571b7b3790c4d",\n        "index": "0x0"\n      }\n    }\n  ],\n  "outputs": [\n    {\n      "capacity": "0x4a817c800",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e"\n      },\n      "type": {\n        "code_hash": "0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e",\n        "hash_type": "type",\n        "args": "0x"\n      }\n    },\n    {\n      "capacity": "0x1242f741bdf5",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e"\n      }\n    }\n  ],\n  "outputs_data": [\n    "0x0000000000000000",\n    "0x"\n  ],\n  "witnesses": [\n    "0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"\n  ]\n}\nsigningEntries: [\n  {\n    type: \'witness_args_lock\',\n    index: 0,\n    message: \'0x4b756c942c7cf999e37b51b730298904148154539590a94cafb07b14fd728cc9\'\n  }\n]\nThe transaction hash is 0xdf206bbebc18f9df18940c4b9bedaaf0b34e7d8640b5bbab5d8610bbb39ccbaa\n\'0xdf206bbebc18f9df18940c4b9bedaaf0b34e7d8640b5bbab5d8610bbb39ccbaa\'\n')))),Object(s.b)("p",null,"When the transaction is committed to the chain, check the capacity by using ckb-cli. You can see the deposited 200 CKB in the result."),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"Ensure the CKB minder is started to enable the transaction to be committed."))),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1}","{1}":!0},'$ ckb-cli wallet get-capacity --address "ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf"\ndao: 200.0 (CKB)\nfree: 77585.38025888 (CKB)\nimmature: 70346.24338446 (CKB)\ntotal: 77785.38025888 (CKB)\n')),Object(s.b)("h3",{id:"list-dao-cells"},"List DAO Cells"),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#listdaocells-2"},"dao.listDaoCells")," function can be used to list DAO cells for a specific type (deposit, withdraw or all). "),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},'dao.listDaoCells(\n  cellProvider: CellProvider,\n  fromAddress: Address,\n  cellType: "all" | "deposit" | "withdraw",\n  { config = undefined }: Options = {}\n)\n')),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/listDAOCells" {8}',title:'"hellolumos/src/buildTXs.ts/listDAOCells"',"{8}":!0},'import { dao } from "@ckb-lumos/common-scripts";\n\nexport async function listDAOCells(\n  fromAddress: string,\n  cellType: "deposit" | "all" | "withdraw"\n) {\n  console.log("List the", cellType, "cells for the address", fromAddress);\n  for await (const cell of dao.listDaoCells(INDEXER, fromAddress, cellType)) {\n    console.log(cell);\n  }\n}\n')),Object(s.b)("p",null,"You can also use the collect function of the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/classes/common_scripts.cellcollector-2.html"},"dao.CellCollector")," class to list the DAO cells of a specific type."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},'import { dao } from "@ckb-lumos/common-scripts";\n\nexport async function listDAOCells2(\n  fromInfo: FromInfo,\n  cellType: "deposit" | "all" | "withdraw"\n) {\n  const CellCollector = new dao.CellCollector(fromInfo, INDEXER, cellType);\n  for await (const cell of CellCollector.collect()) {\n    console.log(cell);\n  }\n}\n')),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"listDAOCells")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7,8}","{1,2,5,7,8}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, buildTXs } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n> await buildTXs.listDAOCells(alice.ADDRESS, \"deposit\");\nList the deposit cells for the address ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf\n{\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0xdf206bbebc18f9df18940c4b9bedaaf0b34e7d8640b5bbab5d8610bbb39ccbaa',\n    index: '0x0'\n  },\n  block_hash: '0x453e13d6da2c863b44cfa49ff8dd421d34f6448cb21e3677bed54a3ffbe05ff9',\n  block_number: '0x13',\n  data: '0x0000000000000000'\n}\n")))),Object(s.b)("h3",{id:"withdraw-a-cell-from-nervos-dao"},"Withdraw a Cell from Nervos DAO"),Object(s.b)("p",null,"Example: "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/withdrawfromDAO" {15}',title:'"hellolumos/src/buildTXs.ts/withdrawfromDAO"',"{15}":!0},'import { TransactionSkeleton } from "@ckb-lumos/helpers";\nimport { common, dao } from "@ckb-lumos/common-scripts";\nimport { Hash, Cell } from "@ckb-lumos/base";\nimport { INDEXER } from "./index";\nconst rpc = new RPC("http://127.0.0.1:8114");\n\nexport async function withdrawfromDAO(\n  cell: Cell,\n  frominfo: string,\n  txFee: bigint,\n  privateKey: string\n): Promise<Hash> {\n  console.log("Withdraw a DAO cell for the address", frominfo);\n  let skeleton = TransactionSkeleton({ cellProvider: INDEXER });\n  skeleton = await dao.withdraw(skeleton, cell, frominfo);\n  skeleton = await common.payFee(skeleton, [frominfo], BigInt(txFee));\n  skeleton = common.prepareSigningEntries(skeleton);\n  //For simplicity and demonstration, this example uses the signandSeal function to sign the transaction.\n  const tx = await signandSeal(skeleton, privateKey);\n  const hash = await rpc.send_transaction(tx);\n  console.log("The transaction hash is", hash);\n  return hash;\n}\n')),Object(s.b)("p",null,"The example creates a transaction skeleton and then uses the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#withdraw-4"},"dao.withdraw")," function to withdraw a deposited cell."),Object(s.b)("p",null,"The steps like adding transaction fee, preparing signing entries, signing and sealing the transaction, are the same as the previous examples. For more information, see the steps in the common transaction and the deposit transaction. "),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"withdrawfromDAO")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7,9-31}","{1,2,5,7,9-31}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, buildTXs } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n# Choose one deposited cell from the result of the listDAOCells step.\n> const depositCell = {\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0xdf206bbebc18f9df18940c4b9bedaaf0b34e7d8640b5bbab5d8610bbb39ccbaa',\n    index: '0x0'\n  },\n  block_hash: '0x453e13d6da2c863b44cfa49ff8dd421d34f6448cb21e3677bed54a3ffbe05ff9',\n  block_number: '0x13',\n  data: '0x0000000000000000'\n}\n> await buildTXs.withdrawfromDAO(depositCell, alice.ADDRESS, 10000000n, alice.PRIVATE_KEY);\nWithdraw a DAO cell for the address ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf\nThe transaction hash is 0x5b2e8e943a9e9209b105e4de63a81657dc7e177dc366b9314b7f794727a9cccb\n'0x5b2e8e943a9e9209b105e4de63a81657dc7e177dc366b9314b7f794727a9cccb'\n")))),Object(s.b)("h3",{id:"unlock-a-withdrawn-cell"},"Unlock a Withdrawn Cell"),Object(s.b)("p",null,"A withdrawn cell must be unlocked to make it usable as a live cell for new transactions."),Object(s.b)("p",null,"The following example uses the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#unlock-2"},"dao.unlock")," function to implement the unlock function."),Object(s.b)("p",null,"Example: "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/unlockWithdraw" {16-22}',title:'"hellolumos/src/buildTXs.ts/unlockWithdraw"',"{16-22}":!0},'import { TransactionSkeleton } from "@ckb-lumos/helpers";\nimport { common, dao } from "@ckb-lumos/common-scripts";\nimport { Hash, Cell } from "@ckb-lumos/base";\nimport { INDEXER } from "./index";\nconst rpc = new RPC("http://127.0.0.1:8114");\n\nexport async function unlockWithdraw(\n  depositinput: Cell,\n  withdrawinput: Cell,\n  toaddress: string,\n  frominfo: string,\n  txFee: bigint,\n  privateKey: string\n): Promise<Hash> {\n  let skeleton = TransactionSkeleton({ cellProvider: INDEXER });\n  skeleton = await dao.unlock(\n    skeleton,\n    depositinput,\n    withdrawinput,\n    toaddress,\n    frominfo\n  );\n  skeleton = await common.payFee(skeleton, [frominfo], BigInt(txFee));\n  skeleton = common.prepareSigningEntries(skeleton);\n  console.log("signingEntries:", skeleton.get("signingEntries").toArray());\n  const tx = await signandSeal(skeleton, privateKey);\n  const hash = await rpc.send_transaction(tx);\n  console.log("The transaction hash is", hash);\n  return hash;\n}\n')),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},'A withdrawn cell can only be successfully unlocked when the epoch reaches the number that fulfills the lock period, i.e. the lock period of the cell has passed. Otherwise the unlock function will throw an error like "... the transaction is immature because of the since requirement...". '))),Object(s.b)("b",null,"The earliest epoch number")," (since when the withdrawn cell can be unlocked) = ",Object(s.b)("b",null,"180")," (the default lock period) + ",Object(s.b)("b",null,Object(s.b)("var",null,"the epoch number of the deposit transaction"))," + ",Object(s.b)("b",null,Object(s.b)("var",null,"the block index of the deposit transaction"))," / ",Object(s.b)("b",null,Object(s.b)("var",null,"the epoch length"),". "),Object(s.b)("p",null,"The epoch information is located in the block header. For the CKB node installed by Tippy, you can check the epoch number and the block index of the deposit transaction on the Tippy Block page."),Object(s.b)("p",null,"The following figure shows the epoch number and the block index of the deposit transaction (0x3162e8ccef8844e83c6cc63122f332f89d7dbd65c7d5f9fa040f4dd532b7abee). The withdrawn cell can be unlocked after epoch (180 + 1 + 9 / 10)."),Object(s.b)("img",{src:Object(c.a)("img/block.png")}),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"unlockWithdraw")," function in the Node.js REPL mode."),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-29,53-74,76}","{1,2,5,7-29,53-74,76}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { querytransactions } = require(\".\");\nThe server is started.\n> const depositCell = {\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0xdf206bbebc18f9df18940c4b9bedaaf0b34e7d8640b5bbab5d8610bbb39ccbaa',\n    index: '0x0'\n  },\n  block_hash: '0x453e13d6da2c863b44cfa49ff8dd421d34f6448cb21e3677bed54a3ffbe05ff9',\n  block_number: '0x13',\n  data: '0x0000000000000000'\n}\n> await buildTXs.listDAOCells(alice.ADDRESS, \"withdraw\");\nList the withdraw cells for the address ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf\n{\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0x5b2e8e943a9e9209b105e4de63a81657dc7e177dc366b9314b7f794727a9cccb',\n    index: '0x0'\n  },\n  block_hash: '0x06b0b91738866e50fd670e8c25dbd7ab35297c497a14c1e084afbea06e07a6b0',\n  block_number: '0x19',\n  data: '0x1300000000000000'\n}\n> const withdrawnCell = {\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0x5b2e8e943a9e9209b105e4de63a81657dc7e177dc366b9314b7f794727a9cccb',\n    index: '0x0'\n  },\n  block_hash: '0x06b0b91738866e50fd670e8c25dbd7ab35297c497a14c1e084afbea06e07a6b0',\n  block_number: '0x19',\n  data: '0x1300000000000000'\n};\n# Unlock the withdrawn cell.\n> await buildTXs.unlockWithdraw(depositCell, withdrawnCell, alice.ADDRESS, alice.ADDRESS, 10000000n, alice.PRIVATE_KEY);\nThe transaction hash is 0x9c29e46995de785a0713e72447c8a0832d7d62cb53272a0d1b075102a21cc23f\n'0x9c29e46995de785a0713e72447c8a0832d7d62cb53272a0d1b075102a21cc23f'\n")))),Object(s.b)("h3",{id:"transfer-ckb-with-locktime-pool"},"Transfer CKB with Locktime Pool"),Object(s.b)("p",null,"Lumos provides the locktime pool for the cells that has a lock period. A cell with a lock period is only available for new transactions when the lock period has passed."),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"The default lock period is 180 epochs. If the cell is still in the lock period, the ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#transfer-12"},"locktimepool.transfer"),' function will throw an error like "Uncaught Error: Not enough capacity in from addresses!". '))),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/locktimePoolTransfer" {19-25}',title:'"hellolumos/src/buildTXs.ts/locktimePoolTransfer"',"{19-25}":!0},'import {\n  TransactionSkeleton,\n  createTransactionFromSkeleton,\n} from "@ckb-lumos/helpers";\nimport { Hash } from "@ckb-lumos/base";\nimport { INDEXER } from "./index";\nconst rpc = new RPC("http://127.0.0.1:8114");\nimport { locktimePool } from "@ckb-lumos/common-scripts";\n\nexport async function locktimePoolTransfer(\n  toaddress: string,\n  frominfo: string,\n  amount: bigint,\n  txFee: bigint,\n  privateKey: string\n): Promise<Hash> {\n  const tipheader = await rpc.get_tip_header();\n  let skeleton = TransactionSkeleton({ cellProvider: INDEXER });\n  skeleton = await locktimePool.transfer(\n    skeleton,\n    [frominfo],\n    toaddress,\n    BigInt(amount),\n    tipheader\n  );\n  console.log(JSON.stringify(createTransactionFromSkeleton(skeleton), null, 2));\n  skeleton = await locktimePool.payFee(skeleton, [frominfo], txFee, tipheader);\n  skeleton = locktimePool.prepareSigningEntries(skeleton);\n  skeleton.get("signingEntries").toArray();\n  const tx = await signandSeal(skeleton, privateKey);\n  const hash = await rpc.send_transaction(tx);\n  console.log("The transaction hash is", hash);\n  return hash;\n}\n')),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"locktimePoolTransfer")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7,9,13,17,42-63,66,72,77,108}","{1,2,5,7,9,13,17,42-63,66,72,77,108}":!0},"$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType \".help\" for more information.\n> const { accounts, querycells, querytransactions, buildTXs } = require(\".\");\nThe server is started.\n> const alice = accounts.ALICE;\n# Perform another deposit action to create a deposit cell \n> await buildTXs.deposit2DAO(alice.ADDRESS, alice.ADDRESS, 20000000000n, 10000000n, alice.PRIVATE_KEY);\n...\nThe transaction hash is 0xc9a29ac9984b508f4bd7bbe3c6453540e1c4f6b03009133bffa250f2c28485ab\n'0xc9a29ac9984b508f4bd7bbe3c6453540e1c4f6b03009133bffa250f2c28485ab'\n> await querytransactions.getTXbyHash(\"0xc9a29ac9984b508f4bd7bbe3c6453540e1c4f6b03009133bffa250f2c28485ab\");\nThe transaction status is committed\nThe block hash for the transaction is 0x3ca4a7ce76b12ae6687f3402e3e840b44f2171f1e4dde38283f05e97e39adc24\n>\n> await buildTXs.listDAOCells(alice.ADDRESS, \"deposit\");\nList the deposit cells for the address ckt1qyq8uqrxpw9tzg4u5waydrzmdmh8raqt0k8qmuetsf\n{\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0xc9a29ac9984b508f4bd7bbe3c6453540e1c4f6b03009133bffa250f2c28485ab',\n    index: '0x0'\n  },\n  block_hash: '0x3ca4a7ce76b12ae6687f3402e3e840b44f2171f1e4dde38283f05e97e39adc24',\n  block_number: '0x72b',\n  data: '0x0000000000000000'\n}\n>\n> const depositCell = {\n  cell_output: {\n    capacity: '0x4a817c800',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0xc9a29ac9984b508f4bd7bbe3c6453540e1c4f6b03009133bffa250f2c28485ab',\n    index: '0x0'\n  },\n  block_hash: '0x3ca4a7ce76b12ae6687f3402e3e840b44f2171f1e4dde38283f05e97e39adc24',\n  block_number: '0x72b',\n  data: '0x0000000000000000'\n}\n>\n# Withdraw the cell from DAO to prepare a withdraw cell that has a lock period.\n> await buildTXs.withdrawfromDAO(depositCell, alice.ADDRESS, 10000000n, alice.PRIVATE_KEY);\n...\nThe transaction hash is 0x6d9a12180755791eaf61d070d8d5112513cfd671d14434bec5b57c91fef17ee8\n'0x6d9a12180755791eaf61d070d8d5112513cfd671d14434bec5b57c91fef17ee8'\n>\n# Check the withdraw transaction status.\n> await querytransactions.getTXbyHash(\"0x6d9a12180755791eaf61d070d8d5112513cfd671d14434bec5b57c91fef17ee8\");\nThe transaction status is committed\nThe block hash for the transaction is 0x23b5e3299f50305f76ad55789e1958a9e26b2145cc9eef464cd14006b8c01304\n>\n# Check the cell in locktimepool, we can see the withdrawn cell in the locktime pool.\n> await querycells.locktimePoolCells(alice.ADDRESS);\n{\n  cell_output: {\n    capacity: '0x4a82d540f',\n    lock: {\n      code_hash: '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8',\n      hash_type: 'type',\n      args: '0x7e00660b8ab122bca3ba468c5b6eee71f40b7d8e'\n    },\n    type: {\n      code_hash: '0x82d76d1b75fe2fd9a27dfbaa65a039221a380d76c926f378d3f81cf3e7e13f2e',\n      hash_type: 'type',\n      args: '0x'\n    }\n  },\n  out_point: {\n    tx_hash: '0x6d9a12180755791eaf61d070d8d5112513cfd671d14434bec5b57c91fef17ee8',\n    index: '0x0'\n  },\n  block_hash: '0x23b5e3299f50305f76ad55789e1958a9e26b2145cc9eef464cd14006b8c01304',\n  block_number: '0x77b',\n  data: '0x2b07000000000000',\n  since: '0x20000a000500016b',\n  depositBlockHash: '0x3ca4a7ce76b12ae6687f3402e3e840b44f2171f1e4dde38283f05e97e39adc24',\n  withdrawBlockHash: '0x23b5e3299f50305f76ad55789e1958a9e26b2145cc9eef464cd14006b8c01304',\n  sinceValidationInfo: undefined\n}\n...\n>\n>\n# When the epoch reaches '0x20000a000500016b'(363 + 5/10), the locktimepool.transfer function can be executed sucessfully.\n> await buildTXs.locktimePoolTransfer(bob.ADDRESS, alice.ADDRESS, 10000000000n, 10000000n, alice.PRIVATE_KEY);\nThe transaction hash is 0x60db4b0dc2e21632a035c021ad05a56e80fd2d50aeb3d9e00aa554f9f7c1e87a\n'0x60db4b0dc2e21632a035c021ad05a56e80fd2d50aeb3d9e00aa554f9f7c1e87a'\n")))),Object(s.b)("h3",{id:"issue-sudt-tokens"},"Issue SUDT Tokens"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"SUDT is the abbreviation of Simple User Defined Token which defines a minimal standard that contains what\u2019s absolutely needed for dapp developers to issue custom tokens on Nervos CKB. You can refer to ",Object(s.b)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0025-simple-udt/0025-simple-udt.md"},"CKB RFC: Simple UDT Draft Spec")," for more details.")),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",{parentName:"div",className:"admonition-heading"},Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",{parentName:"h5",className:"admonition-icon"},Object(s.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(s.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(s.b)("div",{parentName:"div",className:"admonition-content"},Object(s.b)("p",{parentName:"div"},"The SUDT script needs to be deployed to DEV chain before operating on SUDT tokens. For more information about deploying the SUDT script, see ",Object(s.b)("a",{parentName:"p",href:"https://docs.nervos.org/docs/labs/sudtbycapsule"},"Write a SUDT script by Capsule"),". You can also refer to the ",Object(s.b)("a",{parentName:"p",href:"../guides/integratenft#deploy-the-nft-script-on-dev-chain"},"Deploy the NFT Script on DEV Chain")," example for details about deploying a script on DEV chain."))),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#issuetoken-2"},"sudt.issueToken")," function can be used to generate SUDT tokens."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"sudt.issueToken(\n  txSkeleton: TransactionSkeletonType,\n  fromInfo: FromInfo,\n  amount: bigint,\n  capacity?: bigint,\n  tipHeader?: Header,\n  { config = undefined }: Options = {}\n)\n")),Object(s.b)("p",null,"The ",Object(s.b)("var",null,"amount")," parameter means the amount of SUDT tokens to be generated. The ",Object(s.b)("var",null,"capacity")," parameter is  optional, and it means the amount of CKB capacity used for the generation. If ",Object(s.b)("var",null,"capacity")," is not defined, the ",Object(s.b)("inlineCode",{parentName:"p"},"sudt.issueToken")," function will use 142 CKB (the minimal CKB capacity of an SUDT cell) to generate SUDT tokens. "),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/issueSUDT" {23}',title:'"hellolumos/src/buildTXs.ts/issueSUDT"',"{23}":!0},'import {\n  createTransactionFromSkeleton,\n  TransactionSkeleton,\n  TransactionSkeletonType,\n} from "@ckb-lumos/helpers";\nimport { common, sudt } from "@ckb-lumos/common-scripts";\nimport { Hash } from "@ckb-lumos/base";\nimport { INDEXER } from "./index";\nimport { RPC } from "@ckb-lumos/rpc";\nconst rpc = new RPC("http://127.0.0.1:8114");\n\nexport async function issueSUDT(\n  fromInfo: FromInfo,\n  amount: bigint,\n  capacity: bigint,\n  txFee: bigint,\n  privateKey: string\n): Promise<Hash> {\n  let skeleton: TransactionSkeletonType = TransactionSkeleton({\n    cellProvider: INDEXER,\n  });\n  console.log("Issue SUDT tokens.");\n  skeleton = await sudt.issueToken(skeleton, fromInfo, amount, capacity);\n  skeleton = await common.payFee(skeleton, [fromInfo], BigInt(txFee));\n  console.log(createTransactionFromSkeleton(skeleton).inputs.length);\n  skeleton = common.prepareSigningEntries(skeleton);\n  const tx = await signandSeal(skeleton, privateKey);\n  const hash = await rpc.send_transaction(tx);\n  console.log("The transaction hash is", hash);\n  return hash;\n}\n')),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"issueSUDT")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-8}","{1,2,5,7-8}":!0},'$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType ".help" for more information.\n> const { accounts, querytransactions, buildTXs } = require(".");\nThe server is started.\n> const alice = accounts.ALICE;\n> await buildTXs.issueSUDT(alice.ADDRESS, 60000000000n, 20000000000n, 10000000n, alice.PRIVATE_KEY);\nIssue SUDT tokens.\nThe transaction hash is 0xa0b29a0cf416e8971207070860f0add8af25e35b6861b0b08470072d1370bb4b\n\'0xa0b29a0cf416e8971207070860f0add8af25e35b6861b0b08470072d1370bb4b\'\n')))),Object(s.b)("h3",{id:"transfer-sudt-tokens"},"Transfer SUDT Tokens"),Object(s.b)("p",null,"The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#transfer-14"},"sudt.transfer")," function can be used to transfer SUDT tokens."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Constructor")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript"},"sudt.transfer(\n  txSkeleton: TransactionSkeletonType,\n  fromInfos: FromInfo[],\n  sudtToken: Token,\n  toAddress: Address,\n  amount: bigint,\n  changeAddress?: Address,\n  capacity?: bigint,\n  tipHeader?: Header,\n  {\n    config = undefined,\n    LocktimePoolCellCollector = LocktimeCellCollector,\n    splitChangeCell = false,\n  }: Options & {\n    LocktimePoolCellCollector?: any;\n    splitChangeCell?: boolean;\n  } = {}\n)\n")),Object(s.b)("p",null,"The ",Object(s.b)("var",null,"sudtToken")," parameter is the lock hash of the tokens' owner. The ",Object(s.b)("a",{parentName:"p",href:"https://nervosnetwork.github.io/lumos/modules/common_scripts.html#ownerforsudt-2"},"sudt.ownerForSudt")," function can be used to get the lock hash."),Object(s.b)("p",null,"Example:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="hellolumos/src/buildTXs.ts/transferSUDT()" {24-33}',title:'"hellolumos/src/buildTXs.ts/transferSUDT()"',"{24-33}":!0},'import {\n  createTransactionFromSkeleton,\n  TransactionSkeleton,\n  TransactionSkeletonType,\n} from "@ckb-lumos/helpers";\nimport { common, sudt } from "@ckb-lumos/common-scripts";\nimport { Hash } from "@ckb-lumos/base";\nimport { INDEXER } from "./index";\nimport { RPC } from "@ckb-lumos/rpc";\nconst rpc = new RPC("http://127.0.0.1:8114");\n\nexport async function transferSUDT(\n  fromInfo: FromInfo,\n  toAddress: string,\n  amount: bigint,\n  capacity: bigint,\n  txFee: bigint,\n  privateKey: string\n): Promise<Hash> {\n  let skeleton: TransactionSkeletonType = TransactionSkeleton({\n    cellProvider: INDEXER,\n  });\n  console.log("Transfer SUDT tokens.");\n  const sudtToken = sudt.ownerForSudt(fromInfo);\n  skeleton = await sudt.transfer(\n    skeleton,\n    [fromInfo],\n    sudtToken,\n    toAddress,\n    amount,\n    undefined,\n    capacity\n  );\n  skeleton = await common.payFee(skeleton, [fromInfo], BigInt(txFee));\n  console.log(createTransactionFromSkeleton(skeleton).inputs.length);\n  skeleton = common.prepareSigningEntries(skeleton);\n  const tx = await signandSeal(skeleton, privateKey);\n  const hash = await rpc.send_transaction(tx);\n  console.log("The transaction hash is", hash);\n  return hash;\n}\n')),Object(s.b)("p",null,"Try the ",Object(s.b)("inlineCode",{parentName:"p"},"transferSUDT")," function in the Node.js REPL mode:"),Object(s.b)("details",null,Object(s.b)("summary",null,"CLICK ME"),Object(s.b)("p",null,Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-shell",metastring:"{1,2,5,7-9}","{1,2,5,7-9}":!0},'$ cd hellolumos\n$ node --experimental-repl-await\nWelcome to Node.js v14.0.0.\nType ".help" for more information.\n> const { accounts, querytransactions, buildTXs } = require(".");\nThe server is started.\n> const alice = accounts.ALICE;\n> const bob = accounts.BOB;\n> await buildTXs.transferSUDT(alice.ADDRESS, bob.ADDRESS, 20000000000n, 20000000000n, 10000000n, alice.PRIVATE_KEY);\nTransfer SUDT tokens:\nThe transaction hash is 0x1c6c608969d5e09f3e55d1628df05d1f1c26f6f65f6a5e728b66c6eae5e074e2\n\'0x1c6c608969d5e09f3e55d1628df05d1f1c26f6f65f6a5e728b66c6eae5e074e2\'\n> \n')))))}p.isMDXComponent=!0}}]);