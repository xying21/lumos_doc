(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{112:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),d=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=d(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),b=a,m=p["".concat(i,".").concat(b)]||p[b]||u[b]||o;return n?r.a.createElement(m,s(s({ref:t},c),{},{components:n})):r.a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},87:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return d}));var a=n(3),r=n(7),o=(n(0),n(112)),i={id:"database",title:"Set Up the Database"},s={unversionedId:"tutorials/database",id:"tutorials/database",isDocsHomePage:!1,title:"Set Up the Database",description:"Lumos is designed based on the Index-Query-Assemble pattern. The Lumos indexer polls blocks from a CKB node, indexes them and stores the indexed data in a local database to provide optimal query.",source:"@site/docs\\tutorials\\database.md",slug:"/tutorials/database",permalink:"/lumos_doc/docs/tutorials/database",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/tutorials/database.md",version:"current",sidebar:"someSidebar",previous:{title:"Set Up the Config Manager",permalink:"/lumos_doc/docs/tutorials/config"},next:{title:"Create an Extended Private Key",permalink:"/lumos_doc/docs/tutorials/createprivkey"}},l=[{value:"Setup the SQL Database",id:"setup-the-sql-database",children:[{value:"Step 1. Create a PostgreSQL instance.",id:"step-1-create-a-postgresql-instance",children:[]},{value:"Step 2. Clone the Lumos repository to initialize the SQL database.",id:"step-2-clone-the-lumos-repository-to-initialize-the-sql-database",children:[]},{value:"Step 3. Check the Current Indexed Tip",id:"step-3-check-the-current-indexed-tip",children:[]},{value:"Install the Pre-built Native Module for Electron Applications",id:"install-the-pre-built-native-module-for-electron-applications",children:[]}]}],c={toc:l};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Lumos is designed based on the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.nervos.org/docs/reference/cell#index-query-assemble-pattern"}),Object(o.b)("inlineCode",{parentName:"a"},"Index-Query-Assemble"))," pattern. The Lumos indexer polls blocks from a CKB node, indexes them and stores the indexed data in a local database to provide optimal query."),Object(o.b)("p",null,"The Lumos indexer supports two types of databases:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"The RocksDB database: The RocksDB backed indexer is contained in the  ",Object(o.b)("inlineCode",{parentName:"li"},"@ckb-lumos/indexer")," package. After the ",Object(o.b)("inlineCode",{parentName:"li"},"@ckb-lumos/indexer")," package is installed, the RocksDB backed indexer can be used directly."),Object(o.b)("li",{parentName:"ul"},"The SQL database: The Lumos indexer supports the SQL database of the latest stable versions of PostgreSQL and MySQL. A separate package, the ",Object(o.b)("inlineCode",{parentName:"li"},"@ckb-lumos/sql-indexer")," package contains the SQL backed indexer. Specific SQL database settings are required before using the SQL backed indexer. ")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Note"),":  The usage for the SQL backed indexer is not fully verified. It is still in the experimental stage."),Object(o.b)("h2",{id:"setup-the-sql-database"},"Setup the SQL Database"),Object(o.b)("h3",{id:"step-1-create-a-postgresql-instance"},"Step 1. Create a PostgreSQL instance."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ docker run --name postgres -e POSTGRES_USER=user -e POSTGRES_DB=lumos -e POSTGRES_PASSWORD=password -d -p 5432:5432 postgres\n")),Object(o.b)("h3",{id:"step-2-clone-the-lumos-repository-to-initialize-the-sql-database"},"Step 2. Clone the Lumos repository to initialize the SQL database."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ cd $TOP\n$ git clone --recursive https://github.com/nervosnetwork/lumos\n$ cd lumos && git checkout v0.15.0\n$ yarn\n$ cd packages/sql-indexer\n$ cat << EOF > knexfile.js\nmodule.exports = {\n  development: {\n    client: 'postgresql',\n    connection: {\n      database: 'lumos',\n      user:     'postgres',\n      password: 'password'\n    },\n    pool: {\n      min: 2,\n      max: 10\n    },\n    migrations: {\n      tableName: 'knex_migrations'\n    }\n  }\n};\nEOF\n$ npx knex migrate:up\n")),Object(o.b)("h3",{id:"step-3-check-the-current-indexed-tip"},"Step 3. Check the Current Indexed Tip"),Object(o.b)("p",null,"To check the current indexed tip after the indexer is started:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'> const { Indexer, CellCollector, TransactionCollector } = require("@ckb-lumos/sql-indexer");\n> const indexer = new Indexer("http://127.0.0.1:5432", "/tmp/indexed-data");\n> indexer.startForever();\n> await indexer.tip()\n{\n  block_number: \'0x0\',\n  block_hash: \'0x120ab9abd48e3b82f93b88eba8c50a0e1304cc2fffb5573fb14b56c6348f2305\'\n}\n')),Object(o.b)("h3",{id:"install-the-pre-built-native-module-for-electron-applications"},"Install the Pre-built Native Module for Electron Applications"),Object(o.b)("p",null,"The Lumos indexer is based on the CKB indexer that is developed by Rust. To leverage the native Rust code without installing Rust, Lumos provides the Lumos indexer with a pre-built native module of the CKB indexer."),Object(o.b)("p",null,"To install the pre-built native module of the CKB indexer for Electron applications: "),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ LUMOS_NODE_RUNTIME=electron npm i\n")))}d.isMDXComponent=!0}}]);