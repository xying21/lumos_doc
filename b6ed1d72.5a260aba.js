(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{112:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return f}));var a=t(0),o=t.n(a);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},c=Object.keys(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=o.a.createContext({}),p=function(e){var n=o.a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},b=function(e){var n=p(e.components);return o.a.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},u=o.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,c=e.originalType,r=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),b=p(t),u=a,f=b["".concat(r,".").concat(u)]||b[u]||d[u]||c;return t?o.a.createElement(f,l(l({ref:n},i),{},{components:t})):o.a.createElement(f,l({ref:n},i))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var c=t.length,r=new Array(c);r[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var i=2;i<c;i++)r[i]=t[i];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},97:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var a=t(3),o=t(7),c=(t(0),t(112)),r={id:"integratenft",title:"DApps on CKB Workshop Code"},l={unversionedId:"tutorials/integratenft",id:"tutorials/integratenft",isDocsHomePage:!1,title:"DApps on CKB Workshop Code",description:"A code example, DApps on CKB Workshop Code, is provided for the demonstration of integrating NFT on CKB.",source:"@site/docs\\tutorials\\integratenft.md",slug:"/tutorials/integratenft",permalink:"/lumos_doc/docs/tutorials/integratenft",editUrl:"https://github.com/xying21/lumos_doc/tree/master/docs/tutorials/integratenft.md",version:"current",sidebar:"someSidebar",previous:{title:"Assemble Transactions",permalink:"/lumos_doc/docs/tutorials/buildtransactions"},next:{title:"Integrate Nervos DAO with DApps",permalink:"/lumos_doc/docs/tutorials/usedao"}},s=[{value:"NFT",id:"nft",children:[]},{value:"nft-validator",id:"nft-validator",children:[]},{value:"nft-glue",id:"nft-glue",children:[]},{value:"Environment",id:"environment",children:[]},{value:"Steps",id:"steps",children:[{value:"Deploy the NFT Script on DEV Chain",id:"deploy-the-nft-script-on-dev-chain",children:[]},{value:"Operate on NFT Tokens by Using Lumos",id:"operate-on-nft-tokens-by-using-lumos",children:[]}]}],i={toc:s};function p(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("p",null,"A code example, ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/dapps-on-ckb-workshop-code"}),"DApps on CKB Workshop Code"),", is provided for the demonstration of integrating NFT on CKB. "),Object(c.b)("p",null,"The example integrates NFT on CKB mainly by the following two steps:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Deploy the NFT script (contract) on chain with the ",Object(c.b)("strong",{parentName:"li"},"nft-validator")," project."),Object(c.b)("li",{parentName:"ul"},"Operate on NFT tokens with the ",Object(c.b)("strong",{parentName:"li"},"nft-glue")," project.")),Object(c.b)("p",null,"Walking through this example requires the knowledge on CKB scripts and CKB NFT."),Object(c.b)("h3",{id:"nft"},"NFT"),Object(c.b)("p",null,"Non Fungible Tokens (NFTs) are tokens that are not interchangeable or necessarily of equal value, even if they are within the same token class. This includes digital collectibles, game items, and records of ownership of physical assets. "),Object(c.b)("h4",{id:"ckb-nft-data-structure"},"CKB NFT Data Structure"),Object(c.b)("p",null,"An NFT instance is a cell with a type script that references an NFT definition. "),Object(c.b)("p",null,Object(c.b)("em",{parentName:"p"},"NFT Token Instance: Cell Schema + NFT Semantics")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"data:\n  id: 32_bytes\n  type:\n    code_hash: NFT Definition Cell Hash\n    type_hash: code | type\n    args: governance_lock_hash, [other args], *\n  lock: <user_lock>\n")),Object(c.b)("p",null,"For more information about CKB NFT, see the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://talk.nervos.org/t/rfc-ckb-nft-draft-spec/4779"}),"RFC: CKB-NFT Draft Spec"),"."),Object(c.b)("h3",{id:"nft-validator"},"nft-validator"),Object(c.b)("p",null,"The ",Object(c.b)("strong",{parentName:"p"},"nft-validator")," is a Rust based on-chain script validator project for supporting NFT tokens on CKB. ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/capsule"}),"Capsule")," is leveraged to simplify the script development."),Object(c.b)("h3",{id:"nft-glue"},"nft-glue"),Object(c.b)("p",null,"The ",Object(c.b)("strong",{parentName:"p"},"nft-glue")," is a separate project in the code example. It provides operations on NFT tokens with the support of Lumos. ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.google.com/presentation/d/1fQKyOrkN8I61a1ZGXCgRczi6T_zWH0aN-IA2SFpdCU4/edit?usp=sharing"}),"Slides")," and a ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=7ob-WL1eWrQ"}),"video")," are provided for an overview of the architecture and code walkthrough of the nft-glue project. "),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"index.ts")," file under the nft-glue project includes the following operations:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Generate NFT tokens."),Object(c.b)("li",{parentName:"ul"},"List all live NFT cells."),Object(c.b)("li",{parentName:"ul"},"Transfer NFT tokens from one user to another user.")),Object(c.b)("h4",{id:"generate-nft-tokens"},"Generate NFT Tokens"),Object(c.b)("p",null,"The generateNftToken() function can be used to generate NFT tokens (cells)."),Object(c.b)("p",null,"The function firstly inserts a dummy NFT output cell. The dummy cell is exactly the same as a normal cell, except that it uses all zeros as NFT ID. "),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'  let skeleton = TransactionSkeleton({ cellProvider: INDEXER });\n\n  skeleton = skeleton.update("outputs", (outputs) => {\n    return outputs.push({\n      cell_output: {\n        capacity: "0x" + (BigInt(200) * BigInt(100000000)).toString(16),\n        lock: parseAddress(owner),\n        type: buildNftTypeScript(governanceLock),\n      },\n      data:\n        "0x0000000000000000000000000000000000000000000000000000000000000000",\n      out_point: undefined,\n      block_hash: undefined,\n    });\n  });\n')),Object(c.b)("p",null,"Lumos is designed to generate smaller transactions for optimizations of a normal workflow. That means the following two cases may happen: "),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Multiple output cells with the same owner might be merged together."),Object(c.b)("li",{parentName:"ol"},"Transferring to an address which has input cells in the transaction, might result in the input cells being removed to cancel the transfer operation.")),Object(c.b)("p",null,"Because NFT requires special output cell and stable input cell. To avoid further optimizations altering those fields, ",Object(c.b)("inlineCode",{parentName:"p"},"fixedEntries")," can be used to mark the fields as fixed."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'  skeleton = skeleton.update("fixedEntries", (fixedEntries) => {\n    return fixedEntries.push(\n      {\n        field: "outputs",\n        index: 0,\n      }\n    );\n  });\n')),Object(c.b)("p",null,"Lumos is used to provide input cells that accommodate the capacities required by the output cell. ."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"  skeleton = await secp256k1Blake160.injectCapacity(skeleton, 0, fromAddress);\n")),Object(c.b)("p",null,"The following code snippet generates the correct NFT ID based on the first input cell and fill the NFT ID in the NFT output cell. "),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const { CKBHasher } = utils;  \nconst hasher = new CKBHasher();\n  const inputCell = skeleton.get("inputs")!.get(0)!;\n  hasher.update(\n    core.SerializeCellInput(\n      normalizers.NormalizeCellInput({\n        previous_output: inputCell.out_point,\n        since: "0x0",\n      })\n    )\n  );\n  hasher.update("0x0000000000000000");\n  const nftId = hasher.digestHex();\n  skeleton = skeleton.update("outputs", (outputs) => {\n    return outputs.update(0, (output) => {\n      output.data = nftId;\n      return output;\n    });\n  });\n')),Object(c.b)("p",null,"The first input cell requires to be fixed because it is used to generate NFT ID. The following code snippet marks the first input cell as fixed."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'  skeleton = skeleton.update("fixedEntries", (fixedEntries) => {\n    return fixedEntries.push(\n      {\n        field: "inputs",\n        index: 0,\n      }\n    );\n  });\n')),Object(c.b)("p",null,"Because the output cell references the NFT script, the NFT cell dep needs to be included. The ",Object(c.b)("inlineCode",{parentName:"p"},"tx_hash")," and ",Object(c.b)("inlineCode",{parentName:"p"},"index")," of the NFT script cell must be defined in the nft-glue/config.json file."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'import { getConfig, initializeConfig } from "@ckb-lumos/config-manager";\nexport const CONFIG = getConfig();\n\nfunction buildNftCellDep(): CellDep {\n  const NFT = CONFIG.SCRIPTS.NFT;\n  if (!NFT) {\n    throw new Error("NFT script is not configured!");\n  }\n  return {\n    out_point: {\n      tx_hash: NFT.TX_HASH,\n      index: NFT.INDEX,\n    },\n    dep_type: NFT.DEP_TYPE,\n  };\n}\n\nskeleton = skeleton.update("cellDeps", (cellDeps) => {\n    return cellDeps.push(buildNftCellDep());\n  });\n')),Object(c.b)("p",null,"Lumos also provides methods in the common-scripts package to inject fee. The common script is used in the following code snippet to add fee for this transaction."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"// For simplicity, we hardcode 0.1 CKB as transaction fee here.\nconst FEE = BigInt(1*10**8); \nskeleton = await common.payFee(skeleton, [fromAddress], FEE);\n")),Object(c.b)("p",null,"The common.prepareSigningEntries function generates messages that are required in transaction signing phase."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"skeleton = common.prepareSigningEntries(skeleton, { config: CONFIG });\n")),Object(c.b)("h4",{id:"list-all-live-nft-cells"},"List All Live NFT Cells"),Object(c.b)("p",null,"Live NFT cells are the cells with the requested NFT type script."),Object(c.b)("p",null,"For simplicity, the function gathers all cells in a single array. The number of cells may impact the execution performance. "),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'export async function listNftTokens(\n  governanceLock: Script\n): Promise<Array<Cell>> {\n    const collector = INDEXER.collector({\n    type: buildNftTypeScript(governanceLock),\n    data: "any",\n  });\n  const results = [];\n  for await (const cell of collector.collect()) {\n    results.push(cell);\n  }\n  return results;\n}\n')),Object(c.b)("h4",{id:"transfer-nft-tokens-from-one-user-to-another-user"},"Transfer NFT Tokens from One User to Another User"),Object(c.b)("p",null,"The transferNftToken() function transfers NFT tokens from one user to another user."),Object(c.b)("p",null,"For simplicity, the original token sender will pay for the transaction fee. This means the token sender must have spare CKB capacities in addition to the NFT token."),Object(c.b)("p",null,"The following code snippet inserts the input and output cells from the NFT cell into the transaction skeleton."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'let skeleton = TransactionSkeleton({ cellProvider: indexer });\n  \n  skeleton = skeleton\n    .update("inputs", (inputs) => {\n      return inputs.push(nftCell);\n    })\n    .update("outputs", (outputs) => {\n      return outputs.push({\n        cell_output: {\n          capacity: nftCell.cell_output.capacity,\n          lock: parseAddress(toAddress),\n          type: nftCell.cell_output.type,\n        },\n        data: nftCell.data,\n        out_point: undefined,\n        block_hash: undefined,\n      });\n    });\n')),Object(c.b)("p",null,"For extra safety, mark the input and output NFT cells as ",Object(c.b)("inlineCode",{parentName:"p"},"fixedEntries")," ."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'  skeleton = skeleton.update("fixedEntries", (fixedEntries) => {\n    return fixedEntries.push(\n      {\n        field: "inputs",\n        index: 0,\n      },\n      {\n        field: "outputs",\n        index: 0,\n      }\n    );\n  });\n')),Object(c.b)("p",null,"Because the output cell references the NFT script, the NFT cell dep needs to be included. "),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'skeleton = skeleton.update("cellDeps", (cellDeps) => {\n    return cellDeps.push(buildNftCellDep());\n  });\n')),Object(c.b)("p",null,"For simplicity, the token sender will pay for the transaction fee. So the token sender must have spare CKB capacities in addition to the NFT token."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"skeleton = await common.payFee(\n  skeleton,\n  [generateAddress(nftCell.cell_output.lock)],\n  FEE\n);\n")),Object(c.b)("p",null,"The common.prepareSigningEntries() function generates messages that are required in transaction signing phase."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"})," skeleton = common.prepareSigningEntries(skeleton, { config: CONFIG });\n return skeleton;\n")),Object(c.b)("h4",{id:"sign-and-send-transaction-skeleton"},"Sign and Send Transaction Skeleton"),Object(c.b)("p",null,"The signAndSendTransactionSkeleton() function signs the prepared transaction skeleton, for example, the returned result of generateNftToken() or transferNftToken() and send the signed transaction skeleton to the CKB node."),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Note"),": The signing function is just for demonstration and simplicity in this code example. The signing function is separate from Lumos related functions because Lumos do not manage private keys unless absolutely requested. Developers can use a service that handle private keys when developing DApps."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),'export async function signAndSendTransactionSkeleton(\n  skeleton: TransactionSkeletonType,\n  privateKey: HexString\n): Promise<Hash> {\n  const signatures = skeleton\n    .get("signingEntries")\n    .map(({ message }) => {\n      const o = ecdsaSign(\n        new Uint8Array(new Reader(message).toArrayBuffer()),\n        new Uint8Array(new Reader(privateKey).toArrayBuffer())\n      );\n      const signature = new Uint8Array(65);\n      signature.set(o.signature, 0);\n      signature.set([o.recid], 64);\n      return new Reader(signature.buffer).serializeJson();\n    })\n    .toArray();\n  const tx = sealTransaction(skeleton, signatures);\n  const rpc = new RPC(CKB_RPC);\n  const hash = await rpc.send_transaction(tx);\n  return hash;\n}\n')),Object(c.b)("h2",{id:"environment"},"Environment"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"OS: Ubuntu 20.04.2 with KDE Plasma GUI. For more information about the installation of the KDE plasma GUI, see ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://phoenixnap.com/kb/how-to-install-a-gui-on-ubuntu"}),"How to Install a Desktop (GUI) on An Ubuntu Server"),"."),Object(c.b)("li",{parentName:"ul"},"NodeJS  (v14.16.0)"),Object(c.b)("li",{parentName:"ul"},"Yarn (1.22.5)"),Object(c.b)("li",{parentName:"ul"},"GCC and make"),Object(c.b)("li",{parentName:"ul"},"TypeScript version 3.8.3")),Object(c.b)("h2",{id:"steps"},"Steps"),Object(c.b)("h3",{id:"deploy-the-nft-script-on-dev-chain"},"Deploy the NFT Script on DEV Chain"),Object(c.b)("h4",{id:"step-1-install-and-run-a-ckb-node-on-dev-chain"},Object(c.b)("strong",{parentName:"h4"},"Step 1. Install and run a CKB node on DEV chain.")),Object(c.b)("p",null,"The following example installs and runs the CKB version ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/ckb/releases/tag/v0.39.0"}),"0.39.0")," on DEV chain manually."),Object(c.b)("p",null,"To install and run a CKB node on DEV chain manually:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ export TOP=$(pwd)\n$ curl -LO https://github.com/nervosnetwork/ckb/releases/download/v0.39.0/ckb_v0.39.0_x86_64-unknown-linux-gnu.tar.gz\n$ tar xzf ckb_v0.39.0_x86_64-unknown-linux-gnu.tar.gz\n$ export PATH=$PATH:$TOP/ckb_v0.39.0_x86_64-unknown-linux-gnu\n$ ckb -V\nckb 0.39.0\n$ ckb init -C devnet -c dev\nWARN: mining feature is disabled because of lacking the block assembler config options\nInitialized CKB directory in devnet\ncreate specs/dev.toml\ncreate ckb.toml\ncreate ckb-miner.toml\ncreate default.db-options\n$ ckb run -C devnet\n")),Object(c.b)("p",null,"For more information, see ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"../preparation/installckb#install-a-ckb-node-on-dev-chain-manually"}),"Install a CKB Node on DEV Chain Manually"),"."),Object(c.b)("h4",{id:"step-2-create-an-account-by-using-ckb-cli"},Object(c.b)("strong",{parentName:"h4"},"Step 2. Create an account by using ckb-cli.")),Object(c.b)("p",null,"To create an account by using ckb-cli:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Create an account and export the private key for the account."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'$ export TOP=$(pwd)\n$ export PATH=$PATH:$TOP/ckb_v0.39.0_x86_64-unknown-linux-gnu\n$ ckb-cli account new\nYour new account is locked with a password. Please give a password. Do not forget this password.\nPassword: \nRepeat password: \naddress:\n  mainnet: ckb1qyqzz2az9emgl7runavw3tul22gd4qs5ueqs68fy9e\n  testnet: ckt1qyqzz2az9emgl7runavw3tul22gd4qs5ueqs8zhmf9\nlock_arg: 0x212ba22e768ff87c9f58e8af9f5290da8214e641\nlock_hash: 0x85aa4381b04366e88a10fb9519db99b0993bea7ee0ce67c099e5b627538cd212\n$ ckb-cli account export --extended-privkey-path wallet --lock-arg 0x212ba22e768ff87c9f58e8af9f5290da8214e641\nPassword: \nmessage: "Success exported account as extended privkey to: \\"wallet\\", please use this file carefully"\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Get CKB capacity by specifying the ",Object(c.b)("inlineCode",{parentName:"p"},"args")," in the ",Object(c.b)("inlineCode",{parentName:"p"},"block_assembler")," section in ckb.toml with the ",Object(c.b)("inlineCode",{parentName:"p"},"lock_arg")," of the account."),Object(c.b)("p",{parentName:"li"},Object(c.b)("strong",{parentName:"p"},"Note"),": The following example is based on the condition that the CKB node is installed manually. The process of getting capacity for an account is different when the CKB node is installed by using Tippy."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'$ ed devnet/ckb.toml <<EOF\n143a\n[block_assembler]\ncode_hash = "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8"\nargs = "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\nhash_type = "type"\nmessage = "0x"\n.\nwq\nEOF\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Restart the CKB node and start the miner."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ export TOP=$(pwd)\n$ export PATH=$PATH:$TOP/ckb_v0.39.0_x86_64-unknown-linux-gnu.tar.gz\n$ ckb miner -C devnet\n")))),Object(c.b)("h4",{id:"step-3-install-docker-on-ubuntu-and-manage-docker-as-a-non-root-user"},Object(c.b)("strong",{parentName:"h4"},"Step 3. Install Docker on Ubuntu and manage Docker as a non-root user.")),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"To install Docker engine on ",Object(c.b)("strong",{parentName:"li"},"Ubuntu"),", see the Docker documentations of ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.docker.com/engine/install/ubuntu/"}),"Install Docker Engine on Ubuntu"),"."),Object(c.b)("li",{parentName:"ol"},"To manage Docker as a non-root user, see the Docker documentations of ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.docker.com/engine/install/linux-postinstall/"}),"Manage Docker as a non-root user"),".")),Object(c.b)("h4",{id:"step-4-install-capsule"},Object(c.b)("strong",{parentName:"h4"},"Step 4. Install Capsule.")),Object(c.b)("p",null,"Capsule is the tool for building deploying scripts (contracts) on Nervos CKB. The Capsule tool can be installed from source or the pre-built installer."),Object(c.b)("p",null,"The following example installs Capsule on Ubuntu by using the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/capsule/releases/tag/v0.1.3"}),"pre-built installer")," of Capsule. For more information about installation from source, see the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/capsule"}),"Readme")," of Capsule."),Object(c.b)("p",null,"To install Capsule by using the pre-built installer:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Download the pre-built installer of capsule_v0.1.3_x86_64-linux.tar.gz."),Object(c.b)("p",{parentName:"li"},Object(c.b)("strong",{parentName:"p"},"Note"),": Some versions of Capsule are incompatible with the NFT integration code example in this guide. Version ",Object(c.b)("strong",{parentName:"p"},"0.1.3")," is verified and recommended for walking through this NFT integration example."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ curl -LO https://github.com/nervosnetwork/capsule/releases/download/v0.1.3/capsule_v0.1.3_x86_64-linux.tar.gz\n$ tar xzf capsule_v0.1.3_x86_64-linux.tar.gz\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Add ckb-cli and Capsule to the PATH environment variable."),Object(c.b)("p",{parentName:"li"},"To add the PATH variables, add the lines ",Object(c.b)("inlineCode",{parentName:"p"},"export PATH=$PATH:/<path to the file>")," of ckb-cli and Capsule to the end of the ",Object(c.b)("strong",{parentName:"p"},"~/.bashrc")," file for Bash shell."),Object(c.b)("p",{parentName:"li"},"For example:"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"ckb-cli: ",Object(c.b)("inlineCode",{parentName:"p"},"export PATH=$PATH:/home/user1/ckb_v0.39.0_x86_64-unknown-linux-gnu")),Object(c.b)("p",{parentName:"li"},"The folder /home/user1/ckb_v0.40.0_x86_64-unknown-linux-gnu contains the ckb tools installed in ",Object(c.b)("strong",{parentName:"p"},"step 1"),".")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Capsule: ",Object(c.b)("inlineCode",{parentName:"p"},"export PATH=$PATH:/home/user1/capsule_v0.1.3_x86_64-linux")),Object(c.b)("p",{parentName:"li"},"The folder /home/user1/capsule_v0.1.3_x86_64-linux contains the Capsule tools installed in ",Object(c.b)("strong",{parentName:"p"},"step 2"),"."))),Object(c.b)("p",{parentName:"li"},Object(c.b)("strong",{parentName:"p"},"Note"),": The current user must have permissions to run ckb-cli and Capsule. If the execution of ckb-cli or Capsule requires sudo commands, that may cause issues during the deployment process.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Check the Capsule installation."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ capsule check\n------------------------------\ndocker  installed\nckb-cli installed v0.39.0\n------------------------------\n")))),Object(c.b)("h4",{id:"step-5-download-the-example-code"},Object(c.b)("strong",{parentName:"h4"},"Step 5. Download the example code.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ git clone https://github.com/nervosnetwork/dapps-on-ckb-workshop-code.git\n")),Object(c.b)("h4",{id:"step-6-build-the-nft-script"},Object(c.b)("strong",{parentName:"h4"},"Step 6. Build the NFT script.")),Object(c.b)("p",null,"This step compiles and generates the NFT source script to an RISC-V binary program into the ",Object(c.b)("inlineCode",{parentName:"p"},"dapps-on-ckb-workshop-code/nft-validator/build/debug")," folder."),Object(c.b)("p",null,"To build the NFT script:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ cd dapps-on-ckb-workshop-code/nft-validator\n$ capsule build\nBuilding contract nft-validator\n Downloading crates ...\n  Downloaded ckb-allocator v0.1.1\n  Downloaded cc v1.0.58\n  Downloaded ckb-std v0.4.1\n  Downloaded buddy-alloc v0.3.0\n   Compiling cfg-if v0.1.10\n   Compiling cc v1.0.58\n   Compiling buddy-alloc v0.3.0\n   Compiling blake2b-ref v0.1.0\n   Compiling molecule v0.6.0\n   Compiling ckb-allocator v0.1.1\n   Compiling ckb-standalone-types v0.0.1-pre.1\n   Compiling ckb-std v0.4.1\n   Compiling nft-validator v0.1.0 (/code/contracts/nft-validator)\n    Finished dev [unoptimized + debuginfo] target(s) in 58.96s\nDone\n")),Object(c.b)("h4",{id:"step-7-deploy-the-script"},Object(c.b)("strong",{parentName:"h4"},"Step 7. Deploy the script.")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Note"),": The CKB node must start running before the deployment of the NFT script."),Object(c.b)("p",null,"If the node is not started, run ",Object(c.b)("inlineCode",{parentName:"p"},"ckb run -C devnet")," in a terminal to start the node."),Object(c.b)("p",null,"To deploy the NFT script:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Update the ",Object(c.b)("inlineCode",{parentName:"p"},"[lock]")," section in the nft-validator/",Object(c.b)("inlineCode",{parentName:"p"},"deployment.toml")," file with the ",Object(c.b)("inlineCode",{parentName:"p"},"lock_arg"),'  "0x212ba22e768ff87c9f58e8af9f5290da8214e641" of the account created in step 2.'),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'# [[cells]]\n# name = "my_cell"\n# enable_type_id = false\n# location = { file = "build/release/my_cell" }\n\n# # Dep group cells\n# [[dep_groups]]\n# name = "my_dep_group"\n# cells = [\n#   "my_cell",\n#   "secp256k1_data"\n# ]\n\n# # Replace with your own lock if you want to unlock deployed cells.\n# # The deployment code_hash is secp256k1 lock\n[lock]\ncode_hash = "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8"\nargs = "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\nhash_type = "type"\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Generate the release binary."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ capsule build --release\nBuilding contract nft-validator\n   Compiling cc v1.0.58\n   Compiling cfg-if v0.1.10\n   Compiling buddy-alloc v0.3.0\n   Compiling blake2b-ref v0.1.0\n   Compiling molecule v0.6.0\n   Compiling ckb-allocator v0.1.1\n   Compiling ckb-standalone-types v0.0.1-pre.1\n   Compiling ckb-std v0.4.1\n   Compiling nft-validator v0.1.0 (/code/contracts/nft-validator)\n    Finished release [optimized] target(s) in 17.31s\nDone\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Deploy the NFT binary program to DEV chain by using the ",Object(c.b)("inlineCode",{parentName:"p"},"capsule deploy --address <the testnet address of the account created in step 2>")," command."),Object(c.b)("p",{parentName:"li"},"A cell is created with the binary program as cell data on the DEV chain. Transactions on NFT tokens reference the cell by cell deps, and use the NFT script in the transactions."),Object(c.b)("p",{parentName:"li"},Object(c.b)("strong",{parentName:"p"},"Note"),": Remember the ",Object(c.b)("inlineCode",{parentName:"p"},"data_hash")," and ",Object(c.b)("inlineCode",{parentName:"p"},"tx_hash")," that will be used in later NFT operations."),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'$ capsule deploy --address ckt1qyqzz2az9emgl7runavw3tul22gd4qs5ueqs8zhmf9\nCreate directory "/home/xy/dapp/nft-validator/migrations/dev"\nDeployment plan:\n---\nmigrated_capacity: 0.0 (CKB)\nnew_occupied_capacity: 33613.0 (CKB)\ntxs_fee_capacity: 0.0001 (CKB)\ntotal_occupied_capacity: 33613.0 (CKB)\nrecipe:\n  cells:\n    - name: nft\n      index: 0\n      tx_hash: 0xf60675098165131a1d44d75ea0377af34895878d33420ee271b5c10ba7a8e954\n      occupied_capacity: 33613.0 (CKB)\n      data_hash: 0x790420c4244a42e732f8065c275b541695a66c7348f885bb3d9b52d83b279115\n      type_id: ~\n  dep_groups: []\nConfirm deployment? (Yes/No)\nyes\nPassword: \nsend cell_tx f60675098165131a1d44d75ea0377af34895878d33420ee271b5c10ba7a8e954\nDeployment complete\n')))),Object(c.b)("h3",{id:"operate-on-nft-tokens-by-using-lumos"},"Operate on NFT Tokens by Using Lumos"),Object(c.b)("p",null,"After the NFT script is deployed on DEV chain, perform the following steps to interact with and operate on NFT tokens by using Lumos."),Object(c.b)("h4",{id:"step-1-install-dependencies-in-the-nft-glue-project"},Object(c.b)("strong",{parentName:"h4"},"Step 1. Install dependencies in the nft-glue project.")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"$ cd dapps-on-ckb-workshop-code/nft-glue\n$ yarn install\nyarn install v1.22.5\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n[4/4] Building fresh packages...\nDone in 13.02s.\n")),Object(c.b)("h4",{id:"step-2-update-the-configjson-file"},Object(c.b)("strong",{parentName:"h4"},"Step 2. Update the config.json file.")),Object(c.b)("p",null,'To update the config.json file, add the NFT configuration for the NFT script under the "DAO" script.'),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"CODE_HASH")," is the ",Object(c.b)("inlineCode",{parentName:"p"},"data_hash")," from the deployment recipe."),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"TX_HASH")," is the ",Object(c.b)("inlineCode",{parentName:"p"},"tx_hash")," from the deployment recipe."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'    ,\n    "NFT": {\n      "CODE_HASH": "0x790420c4244a42e732f8065c275b541695a66c7348f885bb3d9b52d83b279115",\n      "HASH_TYPE": "data",\n      "TX_HASH": "0xbe6003de6d3d2a03ca54bdbe2e1df47131109b3bd0a941a6284dd761f292d886",\n      "INDEX": "0x0",\n      "DEP_TYPE": "code"\n    }\n')),Object(c.b)("h4",{id:"step-3-add-some-interaction-functions-to-demonstrate-the-operations-on-nft-tokens"},"Step 3. Add some interaction functions to demonstrate the operations on NFT tokens"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Generate NFT tokens")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),'import {\n  Hash,\n  Cell,\n  Script,\n} from "@ckb-lumos/base";\n\nimport { createTransactionFromSkeleton} from "@ckb-lumos/helpers";\nimport {signAndSendTransactionSkeleton, generateNftToken} from "./index";\n\nconst generateNFT = async ()=>  {\nconst fromAddress = "ckt1qyqzz2az9emgl7runavw3tul22gd4qs5ueqs8zhmf9";\n\nconst governanceLock:Script = {\n  code_hash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n  hash_type: "type",\n  args: "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\n};\n\nconst owner = "ckt1qyqzz2az9emgl7runavw3tul22gd4qs5ueqs8zhmf9";\n\nconst privateKey = "0x55d720a7477c211a9126e3917d0764663beb033a1e2f878532d89d56972bd7c2";\n\nconst txSkeleton = await generateNftToken(\n      fromAddress,\n      governanceLock,\n      owner\n    );\n\nconsole.log("Transaction Skeleton:", JSON.stringify(createTransactionFromSkeleton(txSkeleton), null, 2));\n           \nconst hash:Hash = await signAndSendTransactionSkeleton(txSkeleton, privateKey);\nconsole.log("hash",hash);}catch(error){console.log("error:", error)}\n//hash 0xb675528456092e751ef93599e1299703d2cfcf2bb9966bc33d8379bbadf82317\n\n}\ngenerateNFT();\n')),Object(c.b)("p",null,"Result:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'Transaction Skeleton: {\n  "version": "0x0",\n  "cell_deps": [\n    {\n      "out_point": {\n        "tx_hash": "0xace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708",\n        "index": "0x0"\n      },\n      "dep_type": "dep_group"\n    },\n    {\n      "out_point": {\n        "tx_hash": "0xf60675098165131a1d44d75ea0377af34895878d33420ee271b5c10ba7a8e954",\n        "index": "0x0"\n      },\n      "dep_type": "code"\n    }\n  ],\n  "header_deps": [],\n  "inputs": [\n    {\n      "since": "0x0",\n      "previous_output": {\n        "tx_hash": "0x183d20a44567861618120445d16373e1e48dc3daa0d15f0a2295a640082a2c0d",\n        "index": "0x0"\n      }\n    }\n  ],\n  "outputs": [\n    {\n      "capacity": "0x4a817c800",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\n      },\n      "type": {\n        "code_hash": "0x790420c4244a42e732f8065c275b541695a66c7348f885bb3d9b52d83b279115",\n        "hash_type": "data",\n        "args": "0x85aa4381b04366e88a10fb9519db99b0993bea7ee0ce67c099e5b627538cd212"\n      }\n    },\n    {\n      "capacity": "0x1242f6d7e2c9",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\n      }\n    }\n  ],\n  "outputs_data": [\n    "0xe416d0877b63e0f98ab42edd10a02ffd4f267f910df0eb5274400aa3bac23cac",\n    "0x"\n  ],\n  "witnesses": [\n    "0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"\n  ]\n}\nhash 0xb675528456092e751ef93599e1299703d2cfcf2bb9966bc33d8379bbadf82317\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Transfer NFT tokens")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),'import {\n  Cell,\n  Script,\n} from "@ckb-lumos/base";\n\nimport { createTransactionFromSkeleton} from "@ckb-lumos/helpers";\n\nimport {signAndSendTransactionSkeleton, listNftTokens, transferNftToken} from "./index";\nconst transferNFT = async ()=>  {\nconst governanceLock:Script = {\n  code_hash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n  hash_type: "type",\n  args: "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\n};\nconst privateKey = "0x55d720a7477c211a9126e3917d0764663beb033a1e2f878532d89d56972bd7c2";\n\nconst nftCells = await listNftTokens(governanceLock);\nconsole.log("nftCells",nftCells);\n\nconst nftCell:Cell = nftCells[0];\n\nconst toAddress = "ckt1qyqzq3uqxuxt2qkkrr03gj0fahftcqjklcrqnkthm5";\nconst txSkeleton2 = await transferNftToken(nftCell, toAddress);\nconsole.log("Transaction Skeleton 2", JSON.stringify(createTransactionFromSkeleton(txSkeleton2), null, 2));\n\n\nconst hash2:Hash = await signAndSendTransactionSkeleton(txSkeleton2, privateKey);\n\nconsole.log("Transfer success! The transaction hash is ",hash2);\n}\n\ntransferNFT();\n')),Object(c.b)("p",null,"Result:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'nftCells [\n  {\n    cell_output: { capacity: \'0x4a817c800\', lock: [Object], type: [Object] },\n    out_point: {\n      tx_hash: \'0xb675528456092e751ef93599e1299703d2cfcf2bb9966bc33d8379bbadf82317\',\n      index: \'0x0\'\n    },\n    block_hash: \'0x5b68126ea2b441930b58dcfa4a0e2e76900361c966f7a320c57c0d99ae8295cf\',\n    block_number: \'0xa6\',\n    //"0xe416d0877b63e0f98ab42edd10a02ffd4f267f910df0eb5274400aa3bac23cac" is the NFT ID of the NFT cell\n    data: \'0xe416d0877b63e0f98ab42edd10a02ffd4f267f910df0eb5274400aa3bac23cac\'\n  }\n]\nTransaction Skeleton 2 {\n  "version": "0x0",\n  "cell_deps": [\n    {\n      "out_point": {\n        "tx_hash": "0xf60675098165131a1d44d75ea0377af34895878d33420ee271b5c10ba7a8e954",\n        "index": "0x0"\n      },\n      "dep_type": "code"\n    },\n    {\n      "out_point": {\n        "tx_hash": "0xace5ea83c478bb866edf122ff862085789158f5cbff155b7bb5f13058555b708",\n        "index": "0x0"\n      },\n      "dep_type": "dep_group"\n    }\n  ],\n  "header_deps": [],\n  "inputs": [\n    {\n      "since": "0x0",\n      "previous_output": {\n        "tx_hash": "0xb675528456092e751ef93599e1299703d2cfcf2bb9966bc33d8379bbadf82317",\n        "index": "0x0"\n      }\n    },\n    {\n      "since": "0x0",\n      "previous_output": {\n        "tx_hash": "0x1b6994d408db4609ce62dcef18f7206cc2912ee6065e10e02c4bbeca4c027da3",\n        "index": "0x0"\n      }\n    }\n  ],\n  "outputs": [\n    {\n      "capacity": "0x4a817c800",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x204780370cb502d618df1449e9edd2bc0256fe06"\n      },\n      "type": {\n        "code_hash": "0x790420c4244a42e732f8065c275b541695a66c7348f885bb3d9b52d83b279115",\n        "hash_type": "data",\n        "args": "0x85aa4381b04366e88a10fb9519db99b0993bea7ee0ce67c099e5b627538cd212"\n      }\n    },\n    {\n      "capacity": "0x12479e85d13c",\n      "lock": {\n        "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n        "hash_type": "type",\n        "args": "0x212ba22e768ff87c9f58e8af9f5290da8214e641"\n      }\n    }\n  ],\n  "outputs_data": [\n    "0xe416d0877b63e0f98ab42edd10a02ffd4f267f910df0eb5274400aa3bac23cac",\n    "0x"\n  ],\n  "witnesses": [\n    "0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"\n  ]\n}\nTransfer success! The transaction hash is 0xf0659b6aad5eca24234a7d2095fd5ef2e9825e17e175043270a830eca396df26\n')),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Check the new capacity of the toaddress")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ ckb-cli wallet get-capacity --address ckt1qyqzq3uqxuxt2qkkrr03gj0fahftcqjklcrqnkthm5\ntotal: 200.0 (CKB)\n")))}p.isMDXComponent=!0}}]);